<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="exporter-version" content="Evernote Mac 9.3.4 (460189)"/><meta name="keywords" content="微信"/><meta name="created" content="2020-06-07 14:18:06 +0000"/><meta name="source-application" content="微信"/><meta name="source-url" content="https://mp.weixin.qq.com/s/ynLq8MjRLqX6uaYbK17n_Q"/><meta name="updated" content="2020-06-07 14:18:06 +0000"/><title>深入解析 EventLoop 和浏览器渲染、帧动画、空闲回调的关系</title></head><body style="margin:0px;"><div style="padding:8px 0px;margin:8px auto;max-width:700px;"> <div style="margin:0;padding:0;background-color:#fff"><div style="margin:0;padding:0"><div style="margin:0;padding:0;position:relative"><h2 style="font-weight:400;margin:0;padding:0;font-size:22px;line-height:1.4;margin-bottom:14px"> 深入解析 EventLoop 和浏览器渲染、帧动画、空闲回调的关系 </h2><div style="margin:0;padding:0;margin-bottom:22px;line-height:20px;font-size:0;word-wrap:break-word;-webkit-hyphens:auto;-ms-hyphens:auto;hyphens:auto"><span style="padding:0;display:inline-block;vertical-align:middle;margin:0 10px 10px 0;font-size:15px;-webkit-tap-highlight-color:rgba(0,0,0,0);position:relative"><a style="margin:0;padding:0;color:#576b95;text-decoration:none;-webkit-tap-highlight-color:rgba(0,0,0,0)"> 奇舞周刊 </a></span><em style="padding:0;font-style:normal;display:inline-block;vertical-align:middle;margin:0 10px 10px 0;font-size:15px;-webkit-tap-highlight-color:rgba(0,0,0,0);color:rgba(0,0,0,0.3)"/></div><div style="margin:0;padding:0;margin-bottom:24px;font-size:15px"><p style="margin:0;padding:0;line-height:1.4;color:rgba(0,0,0,0.3)"><span style="margin:0;padding:0">以下文章来源于前端从进阶到入院</span><span style="margin:0;padding:0">，作者ssh前端</span></p><a href="https://mp.weixin.qq.com/s/ynLq8MjRLqX6uaYbK17n_Q#" style="margin:0;color:#576b95;text-decoration:none;-webkit-tap-highlight-color:rgba(0,0,0,0);position:relative;background-color:#f7f7f7;border-radius:8px;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;padding:20px 16px;margin-top:16px;line-height:1.4;-webkit-box-align:center;-webkit-align-items:center;align-items:center;display:flex"><div style="margin:0;padding:0"><span style="display:inline-block;background-color:#fff;border-radius:50%;-moz-border-radius:50%;-webkit-border-radius:50%;overflow:hidden;margin:0;padding:0;width:40px;height:40px;margin-right:12px;vertical-align:middle"><img src="%E6%B7%B1%E5%85%A5%E8%A7%A3%E6%9E%90%20EventLoop%20%E5%92%8C%E6%B5%8F%E8%A7%88%E5%99%A8%E6%B8%B2%E6%9F%93%E3%80%81%E5%B8%A7%E5%8A%A8%E7%94%BB%E3%80%81%E7%A9%BA%E9%97%B2%E5%9B%9E%E8%B0%83%E7%9A%84%E5%85%B3%E7%B3%BB.resources/0.jpg" height="596" width="596"/></span></div><div style="margin:0;padding:0;min-width:0;-webkit-box-flex:1;-webkit-flex:1;flex:1"><strong style="margin:0;padding:0;color:rgba(0,0,0,0.9);font-size:17px;font-weight:700;width:auto;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;word-wrap:normal;display:block">前端从进阶到入院</strong><p style="margin:0;padding:0;color:rgba(0,0,0,0.5);font-size:14px;padding-top:4px;width:auto;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;word-wrap:normal">专注于前端技术领域分享，持续更新原创文章，来和我一起成长吧。</p></div></a></div><div style="margin:0;padding:0;overflow:hidden;color:#333;font-size:17px;word-wrap:break-word;-webkit-hyphens:auto;-ms-hyphens:auto;hyphens:auto;text-align:justify;position:relative;z-index:0;__visibility:hidden"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:16px;color:black;padding-right:10px;padding-left:10px;line-height:1.6;letter-spacing:0;word-break:break-word;overflow-wrap:break-word;text-align:left;font-family:Optima-Regular,Optima,PingFangSC-light,PingFangTC-light,&quot;PingFang SC&quot;,Cambria,Cochin,Georgia,Times,&quot;Times New Roman&quot;,serif;margin-top:-10px"><h2 style="font-weight:400;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin:80px 10px 40px;text-align:center;color:rgb(63,63,63);font-size:140%">前言</h2><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;padding-top:8px;padding-bottom:8px;line-height:1.6;color:rgb(63,63,63);margin-top:10px;margin-bottom:10px">关于 Event Loop 的文章很多，但是有很多只是在讲「宏任务」、「微任务」，我先提出几个问题：</p><ol style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-top:8px;margin-bottom:8px;padding-left:25px"><li style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-top:5px;margin-bottom:5px;line-height:26px;color:rgb(1,1,1)">每一轮 Event Loop 都会伴随着渲染吗？</div></li><li style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-top:5px;margin-bottom:5px;line-height:26px;color:rgb(1,1,1)"><code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;overflow-wrap:break-word;margin-right:2px;margin-left:2px;font-family:&quot;Operator Mono&quot;,Consolas,Monaco,Menlo,monospace;word-break:break-all;background:rgb(248,245,236);color:rgb(255,53,2);line-height:1.5;font-size:90%;padding:3px 5px;border-radius:2px">requestAnimationFrame</code> 在哪个阶段执行，在渲染前还是后？在 <code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;overflow-wrap:break-word;margin-right:2px;margin-left:2px;font-family:&quot;Operator Mono&quot;,Consolas,Monaco,Menlo,monospace;word-break:break-all;background:rgb(248,245,236);color:rgb(255,53,2);line-height:1.5;font-size:90%;padding:3px 5px;border-radius:2px">microTask</code> 的前还是后？</div></li><li style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-top:5px;margin-bottom:5px;line-height:26px;color:rgb(1,1,1)"><code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;overflow-wrap:break-word;margin-right:2px;margin-left:2px;font-family:&quot;Operator Mono&quot;,Consolas,Monaco,Menlo,monospace;word-break:break-all;background:rgb(248,245,236);color:rgb(255,53,2);line-height:1.5;font-size:90%;padding:3px 5px;border-radius:2px">requestIdleCallback</code> 在哪个阶段执行？如何去执行？在渲染前还是后？在 <code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;overflow-wrap:break-word;margin-right:2px;margin-left:2px;font-family:&quot;Operator Mono&quot;,Consolas,Monaco,Menlo,monospace;word-break:break-all;background:rgb(248,245,236);color:rgb(255,53,2);line-height:1.5;font-size:90%;padding:3px 5px;border-radius:2px">microTask</code> 的前还是后？</div></li><li style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-top:5px;margin-bottom:5px;line-height:26px;color:rgb(1,1,1)"><code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;overflow-wrap:break-word;margin-right:2px;margin-left:2px;font-family:&quot;Operator Mono&quot;,Consolas,Monaco,Menlo,monospace;word-break:break-all;background:rgb(248,245,236);color:rgb(255,53,2);line-height:1.5;font-size:90%;padding:3px 5px;border-radius:2px">resize</code>、<code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;overflow-wrap:break-word;margin-right:2px;margin-left:2px;font-family:&quot;Operator Mono&quot;,Consolas,Monaco,Menlo,monospace;word-break:break-all;background:rgb(248,245,236);color:rgb(255,53,2);line-height:1.5;font-size:90%;padding:3px 5px;border-radius:2px">scroll</code> 这些事件是何时去派发的。</div></li></ol><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;padding-top:8px;padding-bottom:8px;line-height:1.6;color:rgb(63,63,63);margin-top:10px;margin-bottom:10px">这些问题并不是刻意想刁难你，如果你不知道这些，那你可能并不能在遇到一个动画需求的时候合理的选择 <code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;overflow-wrap:break-word;margin-right:2px;margin-left:2px;font-family:&quot;Operator Mono&quot;,Consolas,Monaco,Menlo,monospace;word-break:break-all;background:rgb(248,245,236);color:rgb(255,53,2);line-height:1.5;font-size:90%;padding:3px 5px;border-radius:2px">requestAnimationFrame</code>，你可能在做一些需求的时候想到了 <code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;overflow-wrap:break-word;margin-right:2px;margin-left:2px;font-family:&quot;Operator Mono&quot;,Consolas,Monaco,Menlo,monospace;word-break:break-all;background:rgb(248,245,236);color:rgb(255,53,2);line-height:1.5;font-size:90%;padding:3px 5px;border-radius:2px">requestIdleCallback</code>，但是你不知道它运行的时机，只是胆战心惊的去用它，祈祷不要出线上 bug。</p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;padding-top:8px;padding-bottom:8px;line-height:1.6;color:rgb(63,63,63);margin-top:10px;margin-bottom:10px">这也是本文想要从规范解读入手，深挖底层的动机之一。本文会酌情从规范中排除掉一些比较晦涩难懂，或者和主流程不太相关的概念。更详细的版本也可以直接去读这个规范，不过比较费时费力。</p><h2 style="font-weight:400;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin:80px 10px 40px;text-align:center;color:rgb(63,63,63);font-size:140%">事件循环</h2><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;padding-top:8px;padding-bottom:8px;line-height:1.6;color:rgb(63,63,63);margin-top:10px;margin-bottom:10px">我们先依据<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(255,53,2);line-height:1.5">HTML 官方规范</span><sup style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;line-height:0;color:rgb(255,53,2)">[1]</sup>从浏览器的事件循环讲起，因为剩下的 API 都在这个循环中进行，它是浏览器调度任务的基础。</p><h3 style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-top:40px;margin-bottom:20px;font-weight:bold;line-height:1.5;color:rgb(63,63,63);font-size:120%">定义</h3><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;padding-top:8px;padding-bottom:8px;line-height:1.6;color:rgb(63,63,63);margin-top:10px;margin-bottom:10px">为了协调事件，用户交互，脚本，渲染，网络任务等，浏览器必须使用本节中描述的事件循环。</p><h3 style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-top:40px;margin-bottom:20px;font-weight:bold;line-height:1.5;color:rgb(63,63,63);font-size:120%">流程</h3><ol style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-top:8px;margin-bottom:8px;padding-left:25px"><li style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-top:5px;margin-bottom:5px;line-height:26px;color:rgb(1,1,1)"><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;padding-top:8px;padding-bottom:8px;line-height:1.6;color:rgb(63,63,63);margin-top:10px;margin-bottom:10px">从任务队列中取出一个<strong style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(255,53,2);line-height:1.5">宏任务</strong>并执行。</p></div></li><li style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-top:5px;margin-bottom:5px;line-height:26px;color:rgb(1,1,1)"><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;padding-top:8px;padding-bottom:8px;line-height:1.6;color:rgb(63,63,63);margin-top:10px;margin-bottom:10px">检查微任务队列，执行并清空<strong style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(255,53,2);line-height:1.5">微任务</strong>队列，如果在微任务的执行中又加入了新的微任务，也会在这一步一起执行。</p></div></li><li style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-top:5px;margin-bottom:5px;line-height:26px;color:rgb(1,1,1)"><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;padding-top:8px;padding-bottom:8px;line-height:1.6;color:rgb(63,63,63);margin-top:10px;margin-bottom:10px">进入更新渲染阶段，判断是否需要渲染，这里有一个 <code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;overflow-wrap:break-word;margin-right:2px;margin-left:2px;font-family:&quot;Operator Mono&quot;,Consolas,Monaco,Menlo,monospace;word-break:break-all;background:rgb(248,245,236);color:rgb(255,53,2);line-height:1.5;font-size:90%;padding:3px 5px;border-radius:2px">rendering opportunity</code> 的概念，也就是说不一定每一轮 event loop 都会对应一次浏览 器渲染，要根据屏幕刷新率、页面性能、页面是否在后台运行来共同决定，通常来说这个渲染间隔是固定的。（所以多个 task 很可能在一次渲染之间执行）</p></div></li><ul style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-top:8px;margin-bottom:8px;padding-left:25px;color:black;list-style-type:disc"><li style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-top:5px;margin-bottom:5px;line-height:26px;color:rgb(1,1,1)">浏览器会尽可能的保持帧率稳定，例如页面性能无法维持 60fps（每 16.66ms 渲染一次）的话，那么浏览器就会选择 30fps 的更新速率，而不是偶尔丢帧。</div></li><li style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-top:5px;margin-bottom:5px;line-height:26px;color:rgb(1,1,1)">如果浏览器上下文不可见，那么页面会降低到 4fps 左右甚至更低。</div></li><li style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-top:5px;margin-bottom:5px;line-height:26px;color:rgb(1,1,1)">如果满足以下条件，也会跳过渲染：</div></li></ul><ol style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-top:8px;margin-bottom:8px;padding-left:25px;color:black;list-style-type:lower-alpha"><li style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-top:5px;margin-bottom:5px;line-height:26px;color:rgb(1,1,1)">浏览器判断更新渲染不会带来视觉上的改变。</div></li><li style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-top:5px;margin-bottom:5px;line-height:26px;color:rgb(1,1,1)"><code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;overflow-wrap:break-word;margin-right:2px;margin-left:2px;font-family:&quot;Operator Mono&quot;,Consolas,Monaco,Menlo,monospace;word-break:break-all;background:rgb(248,245,236);color:rgb(255,53,2);line-height:1.5;font-size:90%;padding:3px 5px;border-radius:2px">map of animation frame callbacks</code> 为空，也就是帧动画回调为空，可以通过 <code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;overflow-wrap:break-word;margin-right:2px;margin-left:2px;font-family:&quot;Operator Mono&quot;,Consolas,Monaco,Menlo,monospace;word-break:break-all;background:rgb(248,245,236);color:rgb(255,53,2);line-height:1.5;font-size:90%;padding:3px 5px;border-radius:2px">requestAnimationFrame</code> 来请求帧动画。</div></li></ol><li style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-top:5px;margin-bottom:5px;line-height:26px;color:rgb(1,1,1)"><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;padding-top:8px;padding-bottom:8px;line-height:1.6;color:rgb(63,63,63);margin-top:10px;margin-bottom:10px">如果上述的判断决定本轮<strong style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(255,53,2);line-height:1.5">不需要渲染</strong>，那么<strong style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(255,53,2);line-height:1.5">下面的几步也不会继续运行</strong>：</p><blockquote style="padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;padding-left:10px;border-left:3px solid #dbdbdb;margin:1em 0;font-size:0.9em;overflow:auto;color:rgb(91,91,91);border-left-color:rgb(158,158,158);background:rgba(158,158,158,0.1);padding-top:1px;padding-bottom:1px;margin-top:20px;margin-bottom:20px"><p style="padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;color:rgb(63,63,63);line-height:1.5;font-size:16px;margin:10px">This step enables the user agent to prevent the steps below from running for other reasons, for example, to ensure certain tasks are executed immediately after each other, with only microtask checkpoints interleaved (and without, e.g., animation frame callbacks interleaved). Concretely, a user agent might wish to coalesce timer callbacks together, with no intermediate rendering updates. 有时候浏览器希望两次「定时器任务」是合并的，他们之间只会穿插着 <code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;overflow-wrap:break-word;margin-right:2px;margin-left:2px;font-family:&quot;Operator Mono&quot;,Consolas,Monaco,Menlo,monospace;word-break:break-all;background:rgb(248,245,236);color:rgb(255,53,2);line-height:1.5;font-size:90%;padding:3px 5px;border-radius:2px">microTask</code>的执行，而不会穿插屏幕渲染相关的流程（比如<code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;overflow-wrap:break-word;margin-right:2px;margin-left:2px;font-family:&quot;Operator Mono&quot;,Consolas,Monaco,Menlo,monospace;word-break:break-all;background:rgb(248,245,236);color:rgb(255,53,2);line-height:1.5;font-size:90%;padding:3px 5px;border-radius:2px">requestAnimationFrame</code>，下面会写一个例子）。</p></blockquote></div></li><li style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-top:5px;margin-bottom:5px;line-height:26px;color:rgb(1,1,1)"><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;padding-top:8px;padding-bottom:8px;line-height:1.6;color:rgb(63,63,63);margin-top:10px;margin-bottom:10px">对于需要渲染的文档，如果窗口的大小发生了变化，执行监听的 <code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;overflow-wrap:break-word;margin-right:2px;margin-left:2px;font-family:&quot;Operator Mono&quot;,Consolas,Monaco,Menlo,monospace;word-break:break-all;background:rgb(248,245,236);color:rgb(255,53,2);line-height:1.5;font-size:90%;padding:3px 5px;border-radius:2px">resize</code> 方法。</p></div></li><li style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-top:5px;margin-bottom:5px;line-height:26px;color:rgb(1,1,1)"><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;padding-top:8px;padding-bottom:8px;line-height:1.6;color:rgb(63,63,63);margin-top:10px;margin-bottom:10px">对于需要渲染的文档，如果页面发生了滚动，执行 <code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;overflow-wrap:break-word;margin-right:2px;margin-left:2px;font-family:&quot;Operator Mono&quot;,Consolas,Monaco,Menlo,monospace;word-break:break-all;background:rgb(248,245,236);color:rgb(255,53,2);line-height:1.5;font-size:90%;padding:3px 5px;border-radius:2px">scroll</code> 方法。</p></div></li><li style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-top:5px;margin-bottom:5px;line-height:26px;color:rgb(1,1,1)"><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;padding-top:8px;padding-bottom:8px;line-height:1.6;color:rgb(63,63,63);margin-top:10px;margin-bottom:10px">对于需要渲染的文档，执行帧动画回调，也就是 <strong style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(255,53,2);line-height:1.5"><code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;overflow-wrap:break-word;margin-right:2px;margin-left:2px;font-family:&quot;Operator Mono&quot;,Consolas,Monaco,Menlo,monospace;word-break:break-all;background:rgb(248,245,236);line-height:1.5;font-size:90%;padding:3px 5px;border-radius:2px">requestAnimationFrame</code></strong> 的回调。（后文会详解）</p></div></li><li style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-top:5px;margin-bottom:5px;line-height:26px;color:rgb(1,1,1)"><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;padding-top:8px;padding-bottom:8px;line-height:1.6;color:rgb(63,63,63);margin-top:10px;margin-bottom:10px">对于需要渲染的文档， 执行 IntersectionObserver 的回调。</p></div></li><li style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-top:5px;margin-bottom:5px;line-height:26px;color:rgb(1,1,1)"><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;padding-top:8px;padding-bottom:8px;line-height:1.6;color:rgb(63,63,63);margin-top:10px;margin-bottom:10px">对于需要渲染的文档，<strong style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(255,53,2);line-height:1.5">重新渲染</strong>绘制用户界面。</p></div></li><li style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-top:5px;margin-bottom:5px;line-height:26px;color:rgb(1,1,1)"><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;padding-top:8px;padding-bottom:8px;line-height:1.6;color:rgb(63,63,63);margin-top:10px;margin-bottom:10px">判断 <code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;overflow-wrap:break-word;margin-right:2px;margin-left:2px;font-family:&quot;Operator Mono&quot;,Consolas,Monaco,Menlo,monospace;word-break:break-all;background:rgb(248,245,236);color:rgb(255,53,2);line-height:1.5;font-size:90%;padding:3px 5px;border-radius:2px">task队列</code>和<code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;overflow-wrap:break-word;margin-right:2px;margin-left:2px;font-family:&quot;Operator Mono&quot;,Consolas,Monaco,Menlo,monospace;word-break:break-all;background:rgb(248,245,236);color:rgb(255,53,2);line-height:1.5;font-size:90%;padding:3px 5px;border-radius:2px">microTask</code>队列是否都为空，如果是的话，则进行 <code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;overflow-wrap:break-word;margin-right:2px;margin-left:2px;font-family:&quot;Operator Mono&quot;,Consolas,Monaco,Menlo,monospace;word-break:break-all;background:rgb(248,245,236);color:rgb(255,53,2);line-height:1.5;font-size:90%;padding:3px 5px;border-radius:2px">Idle</code> 空闲周期的算法，判断是否要执行 <strong style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(255,53,2);line-height:1.5"><code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;overflow-wrap:break-word;margin-right:2px;margin-left:2px;font-family:&quot;Operator Mono&quot;,Consolas,Monaco,Menlo,monospace;word-break:break-all;background:rgb(248,245,236);line-height:1.5;font-size:90%;padding:3px 5px;border-radius:2px">requestIdleCallback</code></strong> 的回调函数。（后文会详解）</p></div></li></ol><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;padding-top:8px;padding-bottom:8px;line-height:1.6;color:rgb(63,63,63);margin-top:10px;margin-bottom:10px">对于<code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;overflow-wrap:break-word;margin-right:2px;margin-left:2px;font-family:&quot;Operator Mono&quot;,Consolas,Monaco,Menlo,monospace;word-break:break-all;background:rgb(248,245,236);color:rgb(255,53,2);line-height:1.5;font-size:90%;padding:3px 5px;border-radius:2px">resize</code> 和 <code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;overflow-wrap:break-word;margin-right:2px;margin-left:2px;font-family:&quot;Operator Mono&quot;,Consolas,Monaco,Menlo,monospace;word-break:break-all;background:rgb(248,245,236);color:rgb(255,53,2);line-height:1.5;font-size:90%;padding:3px 5px;border-radius:2px">scroll</code>来说，并不是到了这一步才去执行滚动和缩放，那岂不是要延迟很多？浏览器当然会立刻帮你滚动视图，根据<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(255,53,2);line-height:1.5">CSSOM 规范</span><sup style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;line-height:0;color:rgb(255,53,2)">[2]</sup>所讲，浏览器会保存一个 <code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;overflow-wrap:break-word;margin-right:2px;margin-left:2px;font-family:&quot;Operator Mono&quot;,Consolas,Monaco,Menlo,monospace;word-break:break-all;background:rgb(248,245,236);color:rgb(255,53,2);line-height:1.5;font-size:90%;padding:3px 5px;border-radius:2px">pending scroll event targets</code>，等到事件循环中的 <code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;overflow-wrap:break-word;margin-right:2px;margin-left:2px;font-family:&quot;Operator Mono&quot;,Consolas,Monaco,Menlo,monospace;word-break:break-all;background:rgb(248,245,236);color:rgb(255,53,2);line-height:1.5;font-size:90%;padding:3px 5px;border-radius:2px">scroll</code>这一步，去派发一个事件到对应的目标上，驱动它去执行监听的回调函数而已。<code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;overflow-wrap:break-word;margin-right:2px;margin-left:2px;font-family:&quot;Operator Mono&quot;,Consolas,Monaco,Menlo,monospace;word-break:break-all;background:rgb(248,245,236);color:rgb(255,53,2);line-height:1.5;font-size:90%;padding:3px 5px;border-radius:2px">resize</code>也是同理。</p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;padding-top:8px;padding-bottom:8px;line-height:1.6;color:rgb(63,63,63);margin-top:10px;margin-bottom:10px">可以在这个流程中仔细看一下「宏任务」、「微任务」、「渲染」之间的关系。</p><h3 style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-top:40px;margin-bottom:20px;font-weight:bold;line-height:1.5;color:rgb(63,63,63);font-size:120%">多任务队列</h3><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;padding-top:8px;padding-bottom:8px;line-height:1.6;color:rgb(63,63,63);margin-top:10px;margin-bottom:10px"><code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;overflow-wrap:break-word;margin-right:2px;margin-left:2px;font-family:&quot;Operator Mono&quot;,Consolas,Monaco,Menlo,monospace;word-break:break-all;background:rgb(248,245,236);color:rgb(255,53,2);line-height:1.5;font-size:90%;padding:3px 5px;border-radius:2px">task</code> 队列并不是我们想象中的那样只有一个，根据规范里的描述：</p><blockquote style="padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;padding-left:10px;border-left:3px solid #dbdbdb;margin:1em 0;font-size:0.9em;overflow:auto;color:rgb(91,91,91);border-left-color:rgb(158,158,158);background:rgba(158,158,158,0.1);padding-top:1px;padding-bottom:1px;margin-top:20px;margin-bottom:20px"><p style="padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;color:rgb(63,63,63);line-height:1.5;font-size:16px;margin:10px">An event loop has one or more task queues. For example, a user agent could have one task queue for mouse and key events (to which the user interaction task source is associated), and another to which all other task sources are associated. Then, using the freedom granted in the initial step of the event loop processing model, it could give keyboard and mouse events preference over other tasks three-quarters of the time, keeping the interface responsive but not starving other task queues. Note that in this setup, the processing model still enforces that the user agent would never process events from any one task source out of order.</p></blockquote><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;padding-top:8px;padding-bottom:8px;line-height:1.6;color:rgb(63,63,63);margin-top:10px;margin-bottom:10px">事件循环中可能会有<strong style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(255,53,2);line-height:1.5">一个或多个</strong>任务队列，这些队列分别为了处理：</p><ol style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-top:8px;margin-bottom:8px;padding-left:25px"><li style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-top:5px;margin-bottom:5px;line-height:26px;color:rgb(1,1,1)">鼠标和键盘事件</div></li><li style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-top:5px;margin-bottom:5px;line-height:26px;color:rgb(1,1,1)">其他的一些 Task</div></li></ol><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;padding-top:8px;padding-bottom:8px;line-height:1.6;color:rgb(63,63,63);margin-top:10px;margin-bottom:10px">浏览器会在保持任务顺序的前提下，可能分配四分之三的优先权给鼠标和键盘事件，保证用户的输入得到最高优先级的响应，而剩下的优先级交给其他 <code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;overflow-wrap:break-word;margin-right:2px;margin-left:2px;font-family:&quot;Operator Mono&quot;,Consolas,Monaco,Menlo,monospace;word-break:break-all;background:rgb(248,245,236);color:rgb(255,53,2);line-height:1.5;font-size:90%;padding:3px 5px;border-radius:2px">Task</code>，并且保证不会“饿死”它们。</p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;padding-top:8px;padding-bottom:8px;line-height:1.6;color:rgb(63,63,63);margin-top:10px;margin-bottom:10px">这个规范也导致 Vue 2.0.0-rc.7 这个版本 <code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;overflow-wrap:break-word;margin-right:2px;margin-left:2px;font-family:&quot;Operator Mono&quot;,Consolas,Monaco,Menlo,monospace;word-break:break-all;background:rgb(248,245,236);color:rgb(255,53,2);line-height:1.5;font-size:90%;padding:3px 5px;border-radius:2px">nextTick</code> 采用了从微任务 <code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;overflow-wrap:break-word;margin-right:2px;margin-left:2px;font-family:&quot;Operator Mono&quot;,Consolas,Monaco,Menlo,monospace;word-break:break-all;background:rgb(248,245,236);color:rgb(255,53,2);line-height:1.5;font-size:90%;padding:3px 5px;border-radius:2px">MutationObserver</code> 更换成宏任务 <code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;overflow-wrap:break-word;margin-right:2px;margin-left:2px;font-family:&quot;Operator Mono&quot;,Consolas,Monaco,Menlo,monospace;word-break:break-all;background:rgb(248,245,236);color:rgb(255,53,2);line-height:1.5;font-size:90%;padding:3px 5px;border-radius:2px">postMessage</code> 而导致了一个 <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(255,53,2);line-height:1.5">Issue</span><sup style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;line-height:0;color:rgb(255,53,2)">[3]</sup>。</p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;padding-top:8px;padding-bottom:8px;line-height:1.6;color:rgb(63,63,63);margin-top:10px;margin-bottom:10px">目前由于一些“未知”的原因，jsfiddle 的案例打不开了。简单描述一下就是采用了 <code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;overflow-wrap:break-word;margin-right:2px;margin-left:2px;font-family:&quot;Operator Mono&quot;,Consolas,Monaco,Menlo,monospace;word-break:break-all;background:rgb(248,245,236);color:rgb(255,53,2);line-height:1.5;font-size:90%;padding:3px 5px;border-radius:2px">task</code> 实现的 <code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;overflow-wrap:break-word;margin-right:2px;margin-left:2px;font-family:&quot;Operator Mono&quot;,Consolas,Monaco,Menlo,monospace;word-break:break-all;background:rgb(248,245,236);color:rgb(255,53,2);line-height:1.5;font-size:90%;padding:3px 5px;border-radius:2px">nextTick</code>，在用户持续滚动的情况下 <code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;overflow-wrap:break-word;margin-right:2px;margin-left:2px;font-family:&quot;Operator Mono&quot;,Consolas,Monaco,Menlo,monospace;word-break:break-all;background:rgb(248,245,236);color:rgb(255,53,2);line-height:1.5;font-size:90%;padding:3px 5px;border-radius:2px">nextTick</code> 任务被延后了很久才去执行，导致动画跟不上滚动了。</p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;padding-top:8px;padding-bottom:8px;line-height:1.6;color:rgb(63,63,63);margin-top:10px;margin-bottom:10px">迫于无奈，尤大还是改回了 <code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;overflow-wrap:break-word;margin-right:2px;margin-left:2px;font-family:&quot;Operator Mono&quot;,Consolas,Monaco,Menlo,monospace;word-break:break-all;background:rgb(248,245,236);color:rgb(255,53,2);line-height:1.5;font-size:90%;padding:3px 5px;border-radius:2px">microTask</code> 去实现 <code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;overflow-wrap:break-word;margin-right:2px;margin-left:2px;font-family:&quot;Operator Mono&quot;,Consolas,Monaco,Menlo,monospace;word-break:break-all;background:rgb(248,245,236);color:rgb(255,53,2);line-height:1.5;font-size:90%;padding:3px 5px;border-radius:2px">nextTick</code>，当然目前来说 <code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;overflow-wrap:break-word;margin-right:2px;margin-left:2px;font-family:&quot;Operator Mono&quot;,Consolas,Monaco,Menlo,monospace;word-break:break-all;background:rgb(248,245,236);color:rgb(255,53,2);line-height:1.5;font-size:90%;padding:3px 5px;border-radius:2px">promise.then</code> 微任务已经比较稳定了，并且 Chrome 也已经实现了 <code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;overflow-wrap:break-word;margin-right:2px;margin-left:2px;font-family:&quot;Operator Mono&quot;,Consolas,Monaco,Menlo,monospace;word-break:break-all;background:rgb(248,245,236);color:rgb(255,53,2);line-height:1.5;font-size:90%;padding:3px 5px;border-radius:2px">queueMicroTask</code> 这个官方 API。不久的未来，我们想要调用微任务队列的话，也可以节省掉实例化 <code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;overflow-wrap:break-word;margin-right:2px;margin-left:2px;font-family:&quot;Operator Mono&quot;,Consolas,Monaco,Menlo,monospace;word-break:break-all;background:rgb(248,245,236);color:rgb(255,53,2);line-height:1.5;font-size:90%;padding:3px 5px;border-radius:2px">Promise</code> 在开销了。</p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;padding-top:8px;padding-bottom:8px;line-height:1.6;color:rgb(63,63,63);margin-top:10px;margin-bottom:10px">从这个 Issue 的例子中我们可以看出，稍微去深入了解一下规范还是比较有好处的，以免在遇到这种比较复杂的 Bug 的时候一脸懵逼。</p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;padding-top:8px;padding-bottom:8px;line-height:1.6;color:rgb(63,63,63);margin-top:10px;margin-bottom:10px">下面的章节中咱们来详细聊聊 <code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;overflow-wrap:break-word;margin-right:2px;margin-left:2px;font-family:&quot;Operator Mono&quot;,Consolas,Monaco,Menlo,monospace;word-break:break-all;background:rgb(248,245,236);color:rgb(255,53,2);line-height:1.5;font-size:90%;padding:3px 5px;border-radius:2px">requestIdleCallback</code> 和 <code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;overflow-wrap:break-word;margin-right:2px;margin-left:2px;font-family:&quot;Operator Mono&quot;,Consolas,Monaco,Menlo,monospace;word-break:break-all;background:rgb(248,245,236);color:rgb(255,53,2);line-height:1.5;font-size:90%;padding:3px 5px;border-radius:2px">requestAnimationFrame</code>。</p><h2 style="font-weight:400;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin:80px 10px 40px;text-align:center;color:rgb(63,63,63);font-size:140%">requestAnimationFrame</h2><blockquote style="padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;padding-left:10px;border-left:3px solid #dbdbdb;margin:1em 0;font-size:0.9em;overflow:auto;color:rgb(91,91,91);border-left-color:rgb(158,158,158);background:rgba(158,158,158,0.1);padding-top:1px;padding-bottom:1px;margin-top:20px;margin-bottom:20px"><p style="padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;color:rgb(63,63,63);line-height:1.5;font-size:16px;margin:10px">以下内容中 <code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;overflow-wrap:break-word;margin-right:2px;margin-left:2px;font-family:&quot;Operator Mono&quot;,Consolas,Monaco,Menlo,monospace;word-break:break-all;background:rgb(248,245,236);color:rgb(255,53,2);line-height:1.5;font-size:90%;padding:3px 5px;border-radius:2px">requestAnimationFrame</code>简称为<code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;overflow-wrap:break-word;margin-right:2px;margin-left:2px;font-family:&quot;Operator Mono&quot;,Consolas,Monaco,Menlo,monospace;word-break:break-all;background:rgb(248,245,236);color:rgb(255,53,2);line-height:1.5;font-size:90%;padding:3px 5px;border-radius:2px">rAF</code></p></blockquote><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;padding-top:8px;padding-bottom:8px;line-height:1.6;color:rgb(63,63,63);margin-top:10px;margin-bottom:10px">在解读规范的过程中，我们发现 <code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;overflow-wrap:break-word;margin-right:2px;margin-left:2px;font-family:&quot;Operator Mono&quot;,Consolas,Monaco,Menlo,monospace;word-break:break-all;background:rgb(248,245,236);color:rgb(255,53,2);line-height:1.5;font-size:90%;padding:3px 5px;border-radius:2px">requestAnimationFrame</code> 的回调有两个特征：</p><ol style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-top:8px;margin-bottom:8px;padding-left:25px"><li style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-top:5px;margin-bottom:5px;line-height:26px;color:rgb(1,1,1)">在重新渲染前调用。</div></li><li style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-top:5px;margin-bottom:5px;line-height:26px;color:rgb(1,1,1)">很可能在宏任务之后不调用。</div></li></ol><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;padding-top:8px;padding-bottom:8px;line-height:1.6;color:rgb(63,63,63);margin-top:10px;margin-bottom:10px">我们来分析一下，为什么要在重新渲染前去调用？因为 <code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;overflow-wrap:break-word;margin-right:2px;margin-left:2px;font-family:&quot;Operator Mono&quot;,Consolas,Monaco,Menlo,monospace;word-break:break-all;background:rgb(248,245,236);color:rgb(255,53,2);line-height:1.5;font-size:90%;padding:3px 5px;border-radius:2px">rAF</code> 是官方推荐的用来做一些流畅动画所应该使用的 API，做动画不可避免的会去更改 DOM，而如果在渲染之后再去更改 DOM，那就只能等到下一轮渲染机会的时候才能去绘制出来了，这显然是不合理的。</p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;padding-top:8px;padding-bottom:8px;line-height:1.6;color:rgb(63,63,63);margin-top:10px;margin-bottom:10px"><code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;overflow-wrap:break-word;margin-right:2px;margin-left:2px;font-family:&quot;Operator Mono&quot;,Consolas,Monaco,Menlo,monospace;word-break:break-all;background:rgb(248,245,236);color:rgb(255,53,2);line-height:1.5;font-size:90%;padding:3px 5px;border-radius:2px">rAF</code>在浏览器决定渲染之前给你最后一个机会去改变 DOM 属性，然后很快在接下来的绘制中帮你呈现出来，所以这是做流畅动画的不二选择。下面我用一个 <code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;overflow-wrap:break-word;margin-right:2px;margin-left:2px;font-family:&quot;Operator Mono&quot;,Consolas,Monaco,Menlo,monospace;word-break:break-all;background:rgb(248,245,236);color:rgb(255,53,2);line-height:1.5;font-size:90%;padding:3px 5px;border-radius:2px">setTimeout</code>的例子来对比。</p><h3 style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-top:40px;margin-bottom:20px;font-weight:bold;line-height:1.5;color:rgb(63,63,63);font-size:120%">闪烁动画</h3><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;padding-top:8px;padding-bottom:8px;line-height:1.6;color:rgb(63,63,63);margin-top:10px;margin-bottom:10px">假设我们现在想要快速的让屏幕上闪烁 <code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;overflow-wrap:break-word;margin-right:2px;margin-left:2px;font-family:&quot;Operator Mono&quot;,Consolas,Monaco,Menlo,monospace;word-break:break-all;background:rgb(248,245,236);color:rgb(255,53,2);line-height:1.5;font-size:90%;padding:3px 5px;border-radius:2px">红</code>、<code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;overflow-wrap:break-word;margin-right:2px;margin-left:2px;font-family:&quot;Operator Mono&quot;,Consolas,Monaco,Menlo,monospace;word-break:break-all;background:rgb(248,245,236);color:rgb(255,53,2);line-height:1.5;font-size:90%;padding:3px 5px;border-radius:2px">蓝</code>两种颜色，保证用户可以观察到，如果我们用 <code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;overflow-wrap:break-word;margin-right:2px;margin-left:2px;font-family:&quot;Operator Mono&quot;,Consolas,Monaco,Menlo,monospace;word-break:break-all;background:rgb(248,245,236);color:rgb(255,53,2);line-height:1.5;font-size:90%;padding:3px 5px;border-radius:2px">setTimeout</code> 来写，并且带着我们长期的误解「宏任务之间一定会伴随着浏览器绘制」，那么你会得到一个预料之外的结果。</p><pre style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-top:10px;margin-bottom:10px"><code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;overflow-x:auto;padding:16px;color:#abb2bf;background:#282c34;display:-webkit-box;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;border-radius:0;font-size:12px;-webkit-overflow-scrolling:touch">setTimeout(<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;line-height:26px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;line-height:26px">()</span> =&gt;</span> {<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>  <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:#e6c07b;line-height:26px">document</span>.body.style.background = <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:#98c379;line-height:26px">"red"</span><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>  setTimeout(<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;line-height:26px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;line-height:26px">()</span> =&gt;</span> {<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>    <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:#e6c07b;line-height:26px">document</span>.body.style.background = <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:#98c379;line-height:26px">"blue"</span><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>  })<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>})<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/></code></pre><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-top:10px;margin-bottom:10px"><img src="%E6%B7%B1%E5%85%A5%E8%A7%A3%E6%9E%90%20EventLoop%20%E5%92%8C%E6%B5%8F%E8%A7%88%E5%99%A8%E6%B8%B2%E6%9F%93%E3%80%81%E5%B8%A7%E5%8A%A8%E7%94%BB%E3%80%81%E7%A9%BA%E9%97%B2%E5%9B%9E%E8%B0%83%E7%9A%84%E5%85%B3%E7%B3%BB.resources/640_2.gif" height="561" width="639"/></div><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;padding-top:8px;padding-bottom:8px;line-height:1.6;color:rgb(63,63,63);margin-top:10px;margin-bottom:10px">可以看出这个结果是非常不可控的，如果这两个 <code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;overflow-wrap:break-word;margin-right:2px;margin-left:2px;font-family:&quot;Operator Mono&quot;,Consolas,Monaco,Menlo,monospace;word-break:break-all;background:rgb(248,245,236);color:rgb(255,53,2);line-height:1.5;font-size:90%;padding:3px 5px;border-radius:2px">Task</code> 之间正好遇到了浏览器认定的渲染机会，那么它会重绘，否则就不会。由于这俩宏任务的间隔周期太短了，所以很大概率是不会的。</p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;padding-top:8px;padding-bottom:8px;line-height:1.6;color:rgb(63,63,63);margin-top:10px;margin-bottom:10px">如果你把延时调整到 <code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;overflow-wrap:break-word;margin-right:2px;margin-left:2px;font-family:&quot;Operator Mono&quot;,Consolas,Monaco,Menlo,monospace;word-break:break-all;background:rgb(248,245,236);color:rgb(255,53,2);line-height:1.5;font-size:90%;padding:3px 5px;border-radius:2px">17ms</code> 那么重绘的概率会大很多，毕竟这个是一般情况下 <code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;overflow-wrap:break-word;margin-right:2px;margin-left:2px;font-family:&quot;Operator Mono&quot;,Consolas,Monaco,Menlo,monospace;word-break:break-all;background:rgb(248,245,236);color:rgb(255,53,2);line-height:1.5;font-size:90%;padding:3px 5px;border-radius:2px">60fps</code> 的一个指标。但是也会出现很多不绘制的情况，所以并不稳定。</p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;padding-top:8px;padding-bottom:8px;line-height:1.6;color:rgb(63,63,63);margin-top:10px;margin-bottom:10px">如果你依赖这个 API 来做动画，那么就很可能会造成「掉帧」。</p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;padding-top:8px;padding-bottom:8px;line-height:1.6;color:rgb(63,63,63);margin-top:10px;margin-bottom:10px">接下来我们换成 <code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;overflow-wrap:break-word;margin-right:2px;margin-left:2px;font-family:&quot;Operator Mono&quot;,Consolas,Monaco,Menlo,monospace;word-break:break-all;background:rgb(248,245,236);color:rgb(255,53,2);line-height:1.5;font-size:90%;padding:3px 5px;border-radius:2px">rAF</code> 试试？我们用一个递归函数来模拟 10 次颜色变化的动画。</p><pre style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-top:10px;margin-bottom:10px"><code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;overflow-x:auto;padding:16px;color:#abb2bf;background:#282c34;display:-webkit-box;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;border-radius:0;font-size:12px;-webkit-overflow-scrolling:touch"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:#c678dd;line-height:26px">let</span> i = <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:#d19a66;line-height:26px">10</span><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:#c678dd;line-height:26px">let</span> req = <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;line-height:26px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;line-height:26px">()</span> =&gt;</span> {<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>  i--<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>  requestAnimationFrame(<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;line-height:26px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;line-height:26px">()</span> =&gt;</span> {<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>    <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:#e6c07b;line-height:26px">document</span>.body.style.background = <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:#98c379;line-height:26px">"red"</span><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>    requestAnimationFrame(<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;line-height:26px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;line-height:26px">()</span> =&gt;</span> {<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>      <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:#e6c07b;line-height:26px">document</span>.body.style.background = <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:#98c379;line-height:26px">"blue"</span><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>      <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:#c678dd;line-height:26px">if</span> (i &gt; <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:#d19a66;line-height:26px">0</span>) {<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>        req()<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>      }<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>    })<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>  })<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>}<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>req()<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/></code></pre><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;padding-top:8px;padding-bottom:8px;line-height:1.6;color:rgb(63,63,63);margin-top:10px;margin-bottom:10px">这里由于颜色变化太快，<code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;overflow-wrap:break-word;margin-right:2px;margin-left:2px;font-family:&quot;Operator Mono&quot;,Consolas,Monaco,Menlo,monospace;word-break:break-all;background:rgb(248,245,236);color:rgb(255,53,2);line-height:1.5;font-size:90%;padding:3px 5px;border-radius:2px">gif</code> 录制软件没办法截出这么高帧率的颜色变换，所以各位可以放到浏览器中自己执行一下试试，我这边直接抛结论，浏览器会非常规律的把这 10 组也就是 20 次颜色变化绘制出来，可以看下 performance 面板记录的表现：</p><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-top:10px;margin-bottom:10px"><img src="%E6%B7%B1%E5%85%A5%E8%A7%A3%E6%9E%90%20EventLoop%20%E5%92%8C%E6%B5%8F%E8%A7%88%E5%99%A8%E6%B8%B2%E6%9F%93%E3%80%81%E5%B8%A7%E5%8A%A8%E7%94%BB%E3%80%81%E7%A9%BA%E9%97%B2%E5%9B%9E%E8%B0%83%E7%9A%84%E5%85%B3%E7%B3%BB.resources/640_2.png" height="170" width="792"/></div><h3 style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-top:40px;margin-bottom:20px;font-weight:bold;line-height:1.5;color:rgb(63,63,63);font-size:120%">定时器合并</h3><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;padding-top:8px;padding-bottom:8px;line-height:1.6;color:rgb(63,63,63);margin-top:10px;margin-bottom:10px">在第一节解读规范的时候，第 4 点中提到了，定时器宏任务可能会直接跳过渲染。</p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;padding-top:8px;padding-bottom:8px;line-height:1.6;color:rgb(63,63,63);margin-top:10px;margin-bottom:10px">按照一些常规的理解来说，宏任务之间理应穿插渲染，而定时器任务就是一个典型的宏任务，看一下以下的代码：</p><pre style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-top:10px;margin-bottom:10px"><code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;overflow-x:auto;padding:16px;color:#abb2bf;background:#282c34;display:-webkit-box;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;border-radius:0;font-size:12px;-webkit-overflow-scrolling:touch">setTimeout(<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;line-height:26px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;line-height:26px">()</span> =&gt;</span> {<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>  <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:#e6c07b;line-height:26px">console</span>.log(<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:#98c379;line-height:26px">"sto"</span>)<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>  requestAnimationFrame(<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;line-height:26px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;line-height:26px">()</span> =&gt;</span> <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:#e6c07b;line-height:26px">console</span>.log(<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:#98c379;line-height:26px">"rAF"</span>))<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>})<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>setTimeout(<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;line-height:26px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;line-height:26px">()</span> =&gt;</span> {<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>  <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:#e6c07b;line-height:26px">console</span>.log(<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:#98c379;line-height:26px">"sto"</span>)<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>  requestAnimationFrame(<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;line-height:26px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;line-height:26px">()</span> =&gt;</span> <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:#e6c07b;line-height:26px">console</span>.log(<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:#98c379;line-height:26px">"rAF"</span>))<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>})<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>queueMicrotask(<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;line-height:26px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;line-height:26px">()</span> =&gt;</span> <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:#e6c07b;line-height:26px">console</span>.log(<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:#98c379;line-height:26px">"mic"</span>))<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>queueMicrotask(<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;line-height:26px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;line-height:26px">()</span> =&gt;</span> <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:#e6c07b;line-height:26px">console</span>.log(<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:#98c379;line-height:26px">"mic"</span>))<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/></code></pre><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;padding-top:8px;padding-bottom:8px;line-height:1.6;color:rgb(63,63,63);margin-top:10px;margin-bottom:10px">从直觉上来看，顺序是不是应该是：</p><pre style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-top:10px;margin-bottom:10px"><code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;overflow-x:auto;padding:16px;color:#abb2bf;background:#282c34;display:-webkit-box;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;border-radius:0;font-size:12px;-webkit-overflow-scrolling:touch">mic<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>mic<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>sto<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>rAF<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>sto<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>rAF<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/></code></pre><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;padding-top:8px;padding-bottom:8px;line-height:1.6;color:rgb(63,63,63);margin-top:10px;margin-bottom:10px">呢？也就是每一个宏任务之后都紧跟着一次渲染。</p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;padding-top:8px;padding-bottom:8px;line-height:1.6;color:rgb(63,63,63);margin-top:10px;margin-bottom:10px">实际上不会，浏览器会合并这两个定时器任务：</p><pre style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-top:10px;margin-bottom:10px"><code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;overflow-x:auto;padding:16px;color:#abb2bf;background:#282c34;display:-webkit-box;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;border-radius:0;font-size:12px;-webkit-overflow-scrolling:touch">mic<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>mic<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>sto<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>sto<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>rAF<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>rAF<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/></code></pre><h2 style="font-weight:400;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin:80px 10px 40px;text-align:center;color:rgb(63,63,63);font-size:140%">requestIdleCallback</h2><h3 style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-top:40px;margin-bottom:20px;font-weight:bold;line-height:1.5;color:rgb(63,63,63);font-size:120%">草案解读</h3><blockquote style="padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;padding-left:10px;border-left:3px solid #dbdbdb;margin:1em 0;font-size:0.9em;overflow:auto;color:rgb(91,91,91);border-left-color:rgb(158,158,158);background:rgba(158,158,158,0.1);padding-top:1px;padding-bottom:1px;margin-top:20px;margin-bottom:20px"><p style="padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;color:rgb(63,63,63);line-height:1.5;font-size:16px;margin:10px">以下内容中 <code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;overflow-wrap:break-word;margin-right:2px;margin-left:2px;font-family:&quot;Operator Mono&quot;,Consolas,Monaco,Menlo,monospace;word-break:break-all;background:rgb(248,245,236);color:rgb(255,53,2);line-height:1.5;font-size:90%;padding:3px 5px;border-radius:2px">requestIdleCallback</code>简称为<code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;overflow-wrap:break-word;margin-right:2px;margin-left:2px;font-family:&quot;Operator Mono&quot;,Consolas,Monaco,Menlo,monospace;word-break:break-all;background:rgb(248,245,236);color:rgb(255,53,2);line-height:1.5;font-size:90%;padding:3px 5px;border-radius:2px">rIC</code>。</p></blockquote><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;padding-top:8px;padding-bottom:8px;line-height:1.6;color:rgb(63,63,63);margin-top:10px;margin-bottom:10px">我们都知道 <code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;overflow-wrap:break-word;margin-right:2px;margin-left:2px;font-family:&quot;Operator Mono&quot;,Consolas,Monaco,Menlo,monospace;word-break:break-all;background:rgb(248,245,236);color:rgb(255,53,2);line-height:1.5;font-size:90%;padding:3px 5px;border-radius:2px">requestIdleCallback</code> 是浏览器提供给我们的空闲调度算法，关于它的简介可以看 <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(255,53,2);line-height:1.5">MDN 文档</span><sup style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;line-height:0;color:rgb(255,53,2)">[4]</sup>，意图是让我们把一些计算量较大但是又没那么紧急的任务放到空闲时间去执行。不要去影响浏览器中优先级较高的任务，比如动画绘制、用户输入等等。</p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;padding-top:8px;padding-bottom:8px;line-height:1.6;color:rgb(63,63,63);margin-top:10px;margin-bottom:10px">React 的时间分片渲染就想要用到这个 API，不过目前浏览器支持的不给力，他们是自己去用 <code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;overflow-wrap:break-word;margin-right:2px;margin-left:2px;font-family:&quot;Operator Mono&quot;,Consolas,Monaco,Menlo,monospace;word-break:break-all;background:rgb(248,245,236);color:rgb(255,53,2);line-height:1.5;font-size:90%;padding:3px 5px;border-radius:2px">postMessage</code> 实现了一套。</p><h4 style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-top:30px;margin-bottom:15px;font-weight:bold;font-size:18px">渲染有序进行</h4><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;padding-top:8px;padding-bottom:8px;line-height:1.6;color:rgb(63,63,63);margin-top:10px;margin-bottom:10px">首先看一张图，很精确的描述了这个 API 的意图：</p><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-top:10px;margin-bottom:10px"><img src="%E6%B7%B1%E5%85%A5%E8%A7%A3%E6%9E%90%20EventLoop%20%E5%92%8C%E6%B5%8F%E8%A7%88%E5%99%A8%E6%B8%B2%E6%9F%93%E3%80%81%E5%B8%A7%E5%8A%A8%E7%94%BB%E3%80%81%E7%A9%BA%E9%97%B2%E5%9B%9E%E8%B0%83%E7%9A%84%E5%85%B3%E7%B3%BB.resources/640.png" height="139" width="737"/></div><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;padding-top:8px;padding-bottom:8px;line-height:1.6;color:rgb(63,63,63);margin-top:10px;margin-bottom:10px">当然，这种有序的 <code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;overflow-wrap:break-word;margin-right:2px;margin-left:2px;font-family:&quot;Operator Mono&quot;,Consolas,Monaco,Menlo,monospace;word-break:break-all;background:rgb(248,245,236);color:rgb(255,53,2);line-height:1.5;font-size:90%;padding:3px 5px;border-radius:2px">浏览器 -&gt; 用户 -&gt; 浏览器 -&gt; 用户</code> 的调度基于一个前提，就是我们要把任务切分成比较小的片，不能说浏览器把空闲时间让给你了，你去执行一个耗时 <code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;overflow-wrap:break-word;margin-right:2px;margin-left:2px;font-family:&quot;Operator Mono&quot;,Consolas,Monaco,Menlo,monospace;word-break:break-all;background:rgb(248,245,236);color:rgb(255,53,2);line-height:1.5;font-size:90%;padding:3px 5px;border-radius:2px">10s</code> 的任务，那肯定也会把浏览器给阻塞住的。这就要求我们去读取 <code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;overflow-wrap:break-word;margin-right:2px;margin-left:2px;font-family:&quot;Operator Mono&quot;,Consolas,Monaco,Menlo,monospace;word-break:break-all;background:rgb(248,245,236);color:rgb(255,53,2);line-height:1.5;font-size:90%;padding:3px 5px;border-radius:2px">rIC</code> 提供给你的 <code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;overflow-wrap:break-word;margin-right:2px;margin-left:2px;font-family:&quot;Operator Mono&quot;,Consolas,Monaco,Menlo,monospace;word-break:break-all;background:rgb(248,245,236);color:rgb(255,53,2);line-height:1.5;font-size:90%;padding:3px 5px;border-radius:2px">deadline</code> 里的时间，去动态的安排我们切分的小任务。浏览器信任了你，你也不能辜负它呀。</p><h4 style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-top:30px;margin-bottom:15px;font-weight:bold;font-size:18px">渲染长期空闲</h4><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;padding-top:8px;padding-bottom:8px;line-height:1.6;color:rgb(63,63,63);margin-top:10px;margin-bottom:10px"><img src="%E6%B7%B1%E5%85%A5%E8%A7%A3%E6%9E%90%20EventLoop%20%E5%92%8C%E6%B5%8F%E8%A7%88%E5%99%A8%E6%B8%B2%E6%9F%93%E3%80%81%E5%B8%A7%E5%8A%A8%E7%94%BB%E3%80%81%E7%A9%BA%E9%97%B2%E5%9B%9E%E8%B0%83%E7%9A%84%E5%85%B3%E7%B3%BB.resources/640_1.png" height="173" width="670"/>还有一种情况，也有可能在几帧的时间内浏览器都是空闲的，并没有发生任何影响视图的操作，它也就不需要去绘制页面：这种情况下为什么还是会有 <code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;overflow-wrap:break-word;margin-right:2px;margin-left:2px;font-family:&quot;Operator Mono&quot;,Consolas,Monaco,Menlo,monospace;word-break:break-all;background:rgb(248,245,236);color:rgb(255,53,2);line-height:1.5;font-size:90%;padding:3px 5px;border-radius:2px">50ms</code> 的 <code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;overflow-wrap:break-word;margin-right:2px;margin-left:2px;font-family:&quot;Operator Mono&quot;,Consolas,Monaco,Menlo,monospace;word-break:break-all;background:rgb(248,245,236);color:rgb(255,53,2);line-height:1.5;font-size:90%;padding:3px 5px;border-radius:2px">deadline</code> 呢？是因为浏览器为了提前应对一些可能会突发的用户交互操作，比如用户输入文字。如果给的时间太长了，你的任务把主线程卡住了，那么用户的交互就得不到回应了。50ms 可以确保用户在无感知的延迟下得到回应。</p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;padding-top:8px;padding-bottom:8px;line-height:1.6;color:rgb(63,63,63);margin-top:10px;margin-bottom:10px">MDN 文档中的<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(255,53,2);line-height:1.5">幕后任务协作调度 API </span><sup style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;line-height:0;color:rgb(255,53,2)">[5]</sup> 介绍的比较清楚，来根据里面的概念做个小实验：</p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;padding-top:8px;padding-bottom:8px;line-height:1.6;color:rgb(63,63,63);margin-top:10px;margin-bottom:10px">屏幕中间有个红色的方块，把 MDN 文档中<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(255,53,2);line-height:1.5">requestAnimationFrame</span><sup style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;line-height:0;color:rgb(255,53,2)">[6]</sup>的范例部分的动画代码直接复制过来。</p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;padding-top:8px;padding-bottom:8px;line-height:1.6;color:rgb(63,63,63);margin-top:10px;margin-bottom:10px">草案中还提到：</p><ol style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-top:8px;margin-bottom:8px;padding-left:25px"><li style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-top:5px;margin-bottom:5px;line-height:26px;color:rgb(1,1,1)"><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;padding-top:8px;padding-bottom:8px;line-height:1.6;color:rgb(63,63,63);margin-top:10px;margin-bottom:10px">当浏览器判断这个页面对用户不可见时，这个回调执行的频率可能被降低到 10 秒执行一次，甚至更低。这点在解读 EventLoop 中也有提及。</p></div></li><li style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-top:5px;margin-bottom:5px;line-height:26px;color:rgb(1,1,1)"><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;padding-top:8px;padding-bottom:8px;line-height:1.6;color:rgb(63,63,63);margin-top:10px;margin-bottom:10px">如果浏览器的工作比较繁忙的时候，不能保证它会提供空闲时间去执行 <code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;overflow-wrap:break-word;margin-right:2px;margin-left:2px;font-family:&quot;Operator Mono&quot;,Consolas,Monaco,Menlo,monospace;word-break:break-all;background:rgb(248,245,236);color:rgb(255,53,2);line-height:1.5;font-size:90%;padding:3px 5px;border-radius:2px">rIC</code> 的回调，而且可能会长期的推迟下去。所以如果你需要保证你的任务在一定时间内一定要执行掉，那么你可以给 <code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;overflow-wrap:break-word;margin-right:2px;margin-left:2px;font-family:&quot;Operator Mono&quot;,Consolas,Monaco,Menlo,monospace;word-break:break-all;background:rgb(248,245,236);color:rgb(255,53,2);line-height:1.5;font-size:90%;padding:3px 5px;border-radius:2px">rIC</code> 传入第二个参数 <code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;overflow-wrap:break-word;margin-right:2px;margin-left:2px;font-family:&quot;Operator Mono&quot;,Consolas,Monaco,Menlo,monospace;word-break:break-all;background:rgb(248,245,236);color:rgb(255,53,2);line-height:1.5;font-size:90%;padding:3px 5px;border-radius:2px">timeout</code>。<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>这会强制浏览器不管多忙，都在超过这个时间之后去执行 <code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;overflow-wrap:break-word;margin-right:2px;margin-left:2px;font-family:&quot;Operator Mono&quot;,Consolas,Monaco,Menlo,monospace;word-break:break-all;background:rgb(248,245,236);color:rgb(255,53,2);line-height:1.5;font-size:90%;padding:3px 5px;border-radius:2px">rIC</code> 的回调函数。所以要谨慎使用，因为它会打断浏览器本身优先级更高的工作。</p></div></li><li style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-top:5px;margin-bottom:5px;line-height:26px;color:rgb(1,1,1)"><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;padding-top:8px;padding-bottom:8px;line-height:1.6;color:rgb(63,63,63);margin-top:10px;margin-bottom:10px">最长期限为 50 毫秒，是根据研究得出的，研究表明，人们通常认为 100 毫秒内对用户输入的响应是瞬时的。将闲置截止期限设置为 50ms 意味着即使在闲置任务开始后立即发生用户输入，浏览器仍然有剩余的 50ms 可以在其中响应用户输入而不会产生用户可察觉的滞后。</p></div></li><li style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-top:5px;margin-bottom:5px;line-height:26px;color:rgb(1,1,1)"><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;padding-top:8px;padding-bottom:8px;line-height:1.6;color:rgb(63,63,63);margin-top:10px;margin-bottom:10px">每次调用 <code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;overflow-wrap:break-word;margin-right:2px;margin-left:2px;font-family:&quot;Operator Mono&quot;,Consolas,Monaco,Menlo,monospace;word-break:break-all;background:rgb(248,245,236);color:rgb(255,53,2);line-height:1.5;font-size:90%;padding:3px 5px;border-radius:2px">timeRemaining()</code> 函数判断是否有剩余时间的时候，如果浏览器判断此时有优先级更高的任务，那么会动态的把这个值设置为 0，否则就是用预先设置好的 <code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;overflow-wrap:break-word;margin-right:2px;margin-left:2px;font-family:&quot;Operator Mono&quot;,Consolas,Monaco,Menlo,monospace;word-break:break-all;background:rgb(248,245,236);color:rgb(255,53,2);line-height:1.5;font-size:90%;padding:3px 5px;border-radius:2px">deadline - now</code> 去计算。</p></div></li><li style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-top:5px;margin-bottom:5px;line-height:26px;color:rgb(1,1,1)"><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;padding-top:8px;padding-bottom:8px;line-height:1.6;color:rgb(63,63,63);margin-top:10px;margin-bottom:10px">这个 <code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;overflow-wrap:break-word;margin-right:2px;margin-left:2px;font-family:&quot;Operator Mono&quot;,Consolas,Monaco,Menlo,monospace;word-break:break-all;background:rgb(248,245,236);color:rgb(255,53,2);line-height:1.5;font-size:90%;padding:3px 5px;border-radius:2px">timeRemaining()</code> 的计算非常动态，会根据很多因素去决定，所以不要指望这个时间是稳定的。</p></div></li></ol><h3 style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-top:40px;margin-bottom:20px;font-weight:bold;line-height:1.5;color:rgb(63,63,63);font-size:120%">动画例子</h3><h4 style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-top:30px;margin-bottom:15px;font-weight:bold;font-size:18px">滚动</h4><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;padding-top:8px;padding-bottom:8px;line-height:1.6;color:rgb(63,63,63);margin-top:10px;margin-bottom:10px">如果我鼠标不做任何动作和交互，直接在控制台通过 <code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;overflow-wrap:break-word;margin-right:2px;margin-left:2px;font-family:&quot;Operator Mono&quot;,Consolas,Monaco,Menlo,monospace;word-break:break-all;background:rgb(248,245,236);color:rgb(255,53,2);line-height:1.5;font-size:90%;padding:3px 5px;border-radius:2px">rIC</code> 去打印这次空闲任务的剩余时间，一般都稳定维持在 <code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;overflow-wrap:break-word;margin-right:2px;margin-left:2px;font-family:&quot;Operator Mono&quot;,Consolas,Monaco,Menlo,monospace;word-break:break-all;background:rgb(248,245,236);color:rgb(255,53,2);line-height:1.5;font-size:90%;padding:3px 5px;border-radius:2px">49.xx</code> ms，因为此时浏览器没有什么优先级更高的任务要去处理。</p><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-top:10px;margin-bottom:10px"><img src="%E6%B7%B1%E5%85%A5%E8%A7%A3%E6%9E%90%20EventLoop%20%E5%92%8C%E6%B5%8F%E8%A7%88%E5%99%A8%E6%B8%B2%E6%9F%93%E3%80%81%E5%B8%A7%E5%8A%A8%E7%94%BB%E3%80%81%E7%A9%BA%E9%97%B2%E5%9B%9E%E8%B0%83%E7%9A%84%E5%85%B3%E7%B3%BB.resources/640.gif" height="388" width="640"/></div><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;padding-top:8px;padding-bottom:8px;line-height:1.6;color:rgb(63,63,63);margin-top:10px;margin-bottom:10px">而如果我不停的滚动浏览器，不断的触发浏览器的重新绘制的话，这个时间就变的非常不稳定了。</p><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-top:10px;margin-bottom:10px"><img src="%E6%B7%B1%E5%85%A5%E8%A7%A3%E6%9E%90%20EventLoop%20%E5%92%8C%E6%B5%8F%E8%A7%88%E5%99%A8%E6%B8%B2%E6%9F%93%E3%80%81%E5%B8%A7%E5%8A%A8%E7%94%BB%E3%80%81%E7%A9%BA%E9%97%B2%E5%9B%9E%E8%B0%83%E7%9A%84%E5%85%B3%E7%B3%BB.resources/640_5.gif" height="388" width="640"/></div><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;padding-top:8px;padding-bottom:8px;line-height:1.6;color:rgb(63,63,63);margin-top:10px;margin-bottom:10px">通过这个例子，你可以更加有体感的感受到什么样叫做「繁忙」，什么样叫做「空闲」。</p><h4 style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-top:30px;margin-bottom:15px;font-weight:bold;font-size:18px">动画</h4><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;padding-top:8px;padding-bottom:8px;line-height:1.6;color:rgb(63,63,63);margin-top:10px;margin-bottom:10px">这个动画的例子很简单，就是利用<code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;overflow-wrap:break-word;margin-right:2px;margin-left:2px;font-family:&quot;Operator Mono&quot;,Consolas,Monaco,Menlo,monospace;word-break:break-all;background:rgb(248,245,236);color:rgb(255,53,2);line-height:1.5;font-size:90%;padding:3px 5px;border-radius:2px">rAF</code>在每帧渲染前的回调中把方块的位置向右移动 10px。</p><pre style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-top:10px;margin-bottom:10px"><code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;overflow-x:auto;padding:16px;color:#abb2bf;background:#282c34;display:-webkit-box;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;border-radius:0;font-size:12px;-webkit-overflow-scrolling:touch"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:#61aeee;line-height:26px">&lt;!DOCTYPE html&gt;</span><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;line-height:26px">&lt;<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:#e06c75;line-height:26px">html</span> <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:#d19a66;line-height:26px">lang</span>=<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:#98c379;line-height:26px">"en"</span>&gt;</span><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>  <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;line-height:26px">&lt;<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:#e06c75;line-height:26px">head</span>&gt;</span><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>    <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;line-height:26px">&lt;<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:#e06c75;line-height:26px">meta</span> <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:#d19a66;line-height:26px">charset</span>=<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:#98c379;line-height:26px">"UTF-8"</span> /&gt;</span><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>    <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;line-height:26px">&lt;<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:#e06c75;line-height:26px">meta</span> <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:#d19a66;line-height:26px">name</span>=<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:#98c379;line-height:26px">"viewport"</span> <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:#d19a66;line-height:26px">content</span>=<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:#98c379;line-height:26px">"width=device-width, initial-scale=1.0"</span> /&gt;</span><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>    <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;line-height:26px">&lt;<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:#e06c75;line-height:26px">title</span>&gt;</span>Document<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;line-height:26px">&lt;/<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:#e06c75;line-height:26px">title</span>&gt;</span><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>    <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;line-height:26px">&lt;<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:#e06c75;line-height:26px">style</span>&gt;</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;line-height:26px"><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>      <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:#61aeee;line-height:26px">#SomeElementYouWantToAnimate</span> {<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>        <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:#98c379;line-height:26px">height</span>: <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:#d19a66;line-height:26px">200px</span>;<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>        <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:#98c379;line-height:26px">width</span>: <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:#d19a66;line-height:26px">200px</span>;<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>        <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:#98c379;line-height:26px">background</span>: red;<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>      }<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>    </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;line-height:26px">&lt;/<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:#e06c75;line-height:26px">style</span>&gt;</span><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>  <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;line-height:26px">&lt;/<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:#e06c75;line-height:26px">head</span>&gt;</span><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>  <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;line-height:26px">&lt;<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:#e06c75;line-height:26px">body</span>&gt;</span><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>    <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;line-height:26px">&lt;<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:#e06c75;line-height:26px">div</span> <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:#d19a66;line-height:26px">id</span>=<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:#98c379;line-height:26px">"SomeElementYouWantToAnimate"</span>&gt;</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;line-height:26px">&lt;/<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:#e06c75;line-height:26px">div</span>&gt;</span><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>    <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;line-height:26px">&lt;<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:#e06c75;line-height:26px">script</span>&gt;</span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;line-height:26px"><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>      <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:#c678dd;line-height:26px">var</span> start = <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:#56b6c2;line-height:26px">null</span><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>      <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:#c678dd;line-height:26px">var</span> element = <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:#e6c07b;line-height:26px">document</span>.getElementById(<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:#98c379;line-height:26px">"SomeElementYouWantToAnimate"</span>)<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>      element.style.position = <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:#98c379;line-height:26px">"absolute"</span><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>      <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;line-height:26px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:#c678dd;line-height:26px">function</span> <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:#61aeee;line-height:26px">step</span>(<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;line-height:26px">timestamp</span>) </span>{<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>        <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:#c678dd;line-height:26px">if</span> (!start) start = timestamp<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>        <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:#c678dd;line-height:26px">var</span> progress = timestamp - start<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>        element.style.left = <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:#e6c07b;line-height:26px">Math</span>.min(progress / <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:#d19a66;line-height:26px">10</span>, <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:#d19a66;line-height:26px">200</span>) + <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:#98c379;line-height:26px">"px"</span><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>        <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:#c678dd;line-height:26px">if</span> (progress &lt; <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:#d19a66;line-height:26px">2000</span>) {<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>          <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:#e6c07b;line-height:26px">window</span>.requestAnimationFrame(step)<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>        }<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>      }<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>      <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:#5c6370;font-style:italic;line-height:26px">// 动画</span><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>      <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:#e6c07b;line-height:26px">window</span>.requestAnimationFrame(step)<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>      <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:#5c6370;font-style:italic;line-height:26px">// 空闲调度</span><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>      <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:#e6c07b;line-height:26px">window</span>.requestIdleCallback(<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;line-height:26px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;line-height:26px">()</span> =&gt;</span> {<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>        alert(<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:#98c379;line-height:26px">"rIC"</span>)<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>      })<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>    </span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;line-height:26px">&lt;/<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:#e06c75;line-height:26px">script</span>&gt;</span><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>  <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;line-height:26px">&lt;/<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:#e06c75;line-height:26px">body</span>&gt;</span><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;line-height:26px">&lt;/<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:#e06c75;line-height:26px">html</span>&gt;</span><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/></code></pre><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;padding-top:8px;padding-bottom:8px;line-height:1.6;color:rgb(63,63,63);margin-top:10px;margin-bottom:10px">注意在最后我加了一个 <code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;overflow-wrap:break-word;margin-right:2px;margin-left:2px;font-family:&quot;Operator Mono&quot;,Consolas,Monaco,Menlo,monospace;word-break:break-all;background:rgb(248,245,236);color:rgb(255,53,2);line-height:1.5;font-size:90%;padding:3px 5px;border-radius:2px">requestIdleCallback</code> 的函数，回调里会 <code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;overflow-wrap:break-word;margin-right:2px;margin-left:2px;font-family:&quot;Operator Mono&quot;,Consolas,Monaco,Menlo,monospace;word-break:break-all;background:rgb(248,245,236);color:rgb(255,53,2);line-height:1.5;font-size:90%;padding:3px 5px;border-radius:2px">alert('rIC')</code>，来看一下演示效果：</p><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-top:10px;margin-bottom:10px"><img src="%E6%B7%B1%E5%85%A5%E8%A7%A3%E6%9E%90%20EventLoop%20%E5%92%8C%E6%B5%8F%E8%A7%88%E5%99%A8%E6%B8%B2%E6%9F%93%E3%80%81%E5%B8%A7%E5%8A%A8%E7%94%BB%E3%80%81%E7%A9%BA%E9%97%B2%E5%9B%9E%E8%B0%83%E7%9A%84%E5%85%B3%E7%B3%BB.resources/640_1.gif" height="297" width="638"/></div><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;padding-top:8px;padding-bottom:8px;line-height:1.6;color:rgb(63,63,63);margin-top:10px;margin-bottom:10px"><code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;overflow-wrap:break-word;margin-right:2px;margin-left:2px;font-family:&quot;Operator Mono&quot;,Consolas,Monaco,Menlo,monospace;word-break:break-all;background:rgb(248,245,236);color:rgb(255,53,2);line-height:1.5;font-size:90%;padding:3px 5px;border-radius:2px">alert</code> 在最开始的时候就执行了，为什么会这样呢一下，想一下「空闲」的概念，我们每一帧仅仅是把 <code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;overflow-wrap:break-word;margin-right:2px;margin-left:2px;font-family:&quot;Operator Mono&quot;,Consolas,Monaco,Menlo,monospace;word-break:break-all;background:rgb(248,245,236);color:rgb(255,53,2);line-height:1.5;font-size:90%;padding:3px 5px;border-radius:2px">left</code> 的值移动了一下，做了这一个简单的渲染，没有占满空闲时间，所以可能在最开始的时候，浏览器就找到机会去调用 <code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;overflow-wrap:break-word;margin-right:2px;margin-left:2px;font-family:&quot;Operator Mono&quot;,Consolas,Monaco,Menlo,monospace;word-break:break-all;background:rgb(248,245,236);color:rgb(255,53,2);line-height:1.5;font-size:90%;padding:3px 5px;border-radius:2px">rIC</code> 的回调函数了。</p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;padding-top:8px;padding-bottom:8px;line-height:1.6;color:rgb(63,63,63);margin-top:10px;margin-bottom:10px">我们简单的修改一下 <code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;overflow-wrap:break-word;margin-right:2px;margin-left:2px;font-family:&quot;Operator Mono&quot;,Consolas,Monaco,Menlo,monospace;word-break:break-all;background:rgb(248,245,236);color:rgb(255,53,2);line-height:1.5;font-size:90%;padding:3px 5px;border-radius:2px">step</code> 函数，在里面加一个很重的任务，1000 次循环打印。</p><pre style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-top:10px;margin-bottom:10px"><code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;overflow-x:auto;padding:16px;color:#abb2bf;background:#282c34;display:-webkit-box;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;border-radius:0;font-size:12px;-webkit-overflow-scrolling:touch"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;line-height:26px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:#c678dd;line-height:26px">function</span> <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:#61aeee;line-height:26px">step</span>(<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;line-height:26px">timestamp</span>) </span>{<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>  <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:#c678dd;line-height:26px">if</span> (!start) start = timestamp<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>  <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:#c678dd;line-height:26px">var</span> progress = timestamp - start<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>  element.style.left = <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:#e6c07b;line-height:26px">Math</span>.min(progress / <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:#d19a66;line-height:26px">10</span>, <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:#d19a66;line-height:26px">200</span>) + <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:#98c379;line-height:26px">"px"</span><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>  <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:#c678dd;line-height:26px">let</span> i = <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:#d19a66;line-height:26px">1000</span><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>  <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:#c678dd;line-height:26px">while</span> (i &gt; <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:#d19a66;line-height:26px">0</span>) {<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>    <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:#e6c07b;line-height:26px">console</span>.log(<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:#98c379;line-height:26px">"i"</span>, i)<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>    i--<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>  }<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>  <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:#c678dd;line-height:26px">if</span> (progress &lt; <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:#d19a66;line-height:26px">2000</span>) {<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>    <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:#e6c07b;line-height:26px">window</span>.requestAnimationFrame(step)<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>  }<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>}<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/></code></pre><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;padding-top:8px;padding-bottom:8px;line-height:1.6;color:rgb(63,63,63);margin-top:10px;margin-bottom:10px">再来看一下它的表现：</p><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-top:10px;margin-bottom:10px"><img src="%E6%B7%B1%E5%85%A5%E8%A7%A3%E6%9E%90%20EventLoop%20%E5%92%8C%E6%B5%8F%E8%A7%88%E5%99%A8%E6%B8%B2%E6%9F%93%E3%80%81%E5%B8%A7%E5%8A%A8%E7%94%BB%E3%80%81%E7%A9%BA%E9%97%B2%E5%9B%9E%E8%B0%83%E7%9A%84%E5%85%B3%E7%B3%BB.resources/640_4.gif" height="297" width="638"/></div><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;padding-top:8px;padding-bottom:8px;line-height:1.6;color:rgb(63,63,63);margin-top:10px;margin-bottom:10px">其实和我们预期的一样，由于浏览器的每一帧都"太忙了",导致它真的就无视我们的 <code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;overflow-wrap:break-word;margin-right:2px;margin-left:2px;font-family:&quot;Operator Mono&quot;,Consolas,Monaco,Menlo,monospace;word-break:break-all;background:rgb(248,245,236);color:rgb(255,53,2);line-height:1.5;font-size:90%;padding:3px 5px;border-radius:2px">rIC</code> 函数了。</p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;padding-top:8px;padding-bottom:8px;line-height:1.6;color:rgb(63,63,63);margin-top:10px;margin-bottom:10px">如果给 <code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;overflow-wrap:break-word;margin-right:2px;margin-left:2px;font-family:&quot;Operator Mono&quot;,Consolas,Monaco,Menlo,monospace;word-break:break-all;background:rgb(248,245,236);color:rgb(255,53,2);line-height:1.5;font-size:90%;padding:3px 5px;border-radius:2px">rIC</code> 函数加一个 <code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;overflow-wrap:break-word;margin-right:2px;margin-left:2px;font-family:&quot;Operator Mono&quot;,Consolas,Monaco,Menlo,monospace;word-break:break-all;background:rgb(248,245,236);color:rgb(255,53,2);line-height:1.5;font-size:90%;padding:3px 5px;border-radius:2px">timeout</code> 呢：</p><pre style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-top:10px;margin-bottom:10px"><code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;overflow-x:auto;padding:16px;color:#abb2bf;background:#282c34;display:-webkit-box;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;border-radius:0;font-size:12px;-webkit-overflow-scrolling:touch"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:#5c6370;font-style:italic;line-height:26px">// 空闲调度</span><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:#e6c07b;line-height:26px">window</span>.requestIdleCallback(<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>  <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;line-height:26px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;line-height:26px">()</span> =&gt;</span> {<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>    alert(<span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:#98c379;line-height:26px">"rID"</span>)<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>  },<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>  { <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:#d19a66;line-height:26px">timeout</span>: <span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:#d19a66;line-height:26px">500</span> },<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/>)<br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/></code></pre><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-top:10px;margin-bottom:10px"><img src="%E6%B7%B1%E5%85%A5%E8%A7%A3%E6%9E%90%20EventLoop%20%E5%92%8C%E6%B5%8F%E8%A7%88%E5%99%A8%E6%B8%B2%E6%9F%93%E3%80%81%E5%B8%A7%E5%8A%A8%E7%94%BB%E3%80%81%E7%A9%BA%E9%97%B2%E5%9B%9E%E8%B0%83%E7%9A%84%E5%85%B3%E7%B3%BB.resources/640_3.gif" height="297" width="638"/></div><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;padding-top:8px;padding-bottom:8px;line-height:1.6;color:rgb(63,63,63);margin-top:10px;margin-bottom:10px">浏览器会在大概 <code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;overflow-wrap:break-word;margin-right:2px;margin-left:2px;font-family:&quot;Operator Mono&quot;,Consolas,Monaco,Menlo,monospace;word-break:break-all;background:rgb(248,245,236);color:rgb(255,53,2);line-height:1.5;font-size:90%;padding:3px 5px;border-radius:2px">500ms</code> 的时候，不管有多忙，都去强制执行 <code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;overflow-wrap:break-word;margin-right:2px;margin-left:2px;font-family:&quot;Operator Mono&quot;,Consolas,Monaco,Menlo,monospace;word-break:break-all;background:rgb(248,245,236);color:rgb(255,53,2);line-height:1.5;font-size:90%;padding:3px 5px;border-radius:2px">rIC</code> 函数，这个机制可以防止我们的空闲任务被“饿死”。</p><h2 style="font-weight:400;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin:80px 10px 40px;text-align:center;color:rgb(63,63,63);font-size:140%">总结</h2><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;padding-top:8px;padding-bottom:8px;line-height:1.6;color:rgb(63,63,63);margin-top:10px;margin-bottom:10px">通过本文的学习过程，我自己也打破了很多对于 Event Loop 以及 rAF、rIC 函数的固有错误认知，通过本文我们可以整理出以下的几个关键点。</p><ol style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-top:8px;margin-bottom:8px;padding-left:25px"><li style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-top:5px;margin-bottom:5px;line-height:26px;color:rgb(1,1,1)">事件循环不一定每轮都伴随着重渲染，但是一定会伴随着微任务执行。</div></li><li style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-top:5px;margin-bottom:5px;line-height:26px;color:rgb(1,1,1)">决定浏览器视图是否渲染的因素很多，浏览器是非常聪明的。</div></li><li style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-top:5px;margin-bottom:5px;line-height:26px;color:rgb(1,1,1)"><code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;overflow-wrap:break-word;margin-right:2px;margin-left:2px;font-family:&quot;Operator Mono&quot;,Consolas,Monaco,Menlo,monospace;word-break:break-all;background:rgb(248,245,236);color:rgb(255,53,2);line-height:1.5;font-size:90%;padding:3px 5px;border-radius:2px">requestAnimationFrame</code>在重新渲染屏幕之前执行，非常适合用来做动画。</div></li><li style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-top:5px;margin-bottom:5px;line-height:26px;color:rgb(1,1,1)"><code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;overflow-wrap:break-word;margin-right:2px;margin-left:2px;font-family:&quot;Operator Mono&quot;,Consolas,Monaco,Menlo,monospace;word-break:break-all;background:rgb(248,245,236);color:rgb(255,53,2);line-height:1.5;font-size:90%;padding:3px 5px;border-radius:2px">requestIdleCallback</code>在渲染屏幕之后执行，并且是否有空执行要看浏览器的调度，如果你一定要它在某个时间内执行，请使用 <code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;overflow-wrap:break-word;margin-right:2px;margin-left:2px;font-family:&quot;Operator Mono&quot;,Consolas,Monaco,Menlo,monospace;word-break:break-all;background:rgb(248,245,236);color:rgb(255,53,2);line-height:1.5;font-size:90%;padding:3px 5px;border-radius:2px">timeout</code>参数。</div></li><li style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-top:5px;margin-bottom:5px;line-height:26px;color:rgb(1,1,1)"><code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;overflow-wrap:break-word;margin-right:2px;margin-left:2px;font-family:&quot;Operator Mono&quot;,Consolas,Monaco,Menlo,monospace;word-break:break-all;background:rgb(248,245,236);color:rgb(255,53,2);line-height:1.5;font-size:90%;padding:3px 5px;border-radius:2px">resize</code>和<code style="margin:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;overflow-wrap:break-word;margin-right:2px;margin-left:2px;font-family:&quot;Operator Mono&quot;,Consolas,Monaco,Menlo,monospace;word-break:break-all;background:rgb(248,245,236);color:rgb(255,53,2);line-height:1.5;font-size:90%;padding:3px 5px;border-radius:2px">scroll</code>事件其实自带节流，它只在 Event Loop 的渲染阶段去执行事件。</div></li></ol><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;padding-top:8px;padding-bottom:8px;line-height:1.6;color:rgb(63,63,63);margin-top:10px;margin-bottom:10px">另外，本文也是对于规范的解读，规范里的一些术语比较晦涩难懂，所以我也结合了一些自己的理解去写这篇文章，如果有错误的地方欢迎各位小伙伴指出。</p><h2 style="font-weight:400;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin:80px 10px 40px;text-align:center;color:rgb(63,63,63);font-size:140%">参考资料</h2><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;padding-top:8px;padding-bottom:8px;line-height:1.6;color:rgb(63,63,63);margin-top:10px;margin-bottom:10px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(255,53,2);line-height:1.5">HTML 规范文档</span><sup style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;line-height:0;color:rgb(255,53,2)">[7]</sup></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;padding-top:8px;padding-bottom:8px;line-height:1.6;color:rgb(63,63,63);margin-top:10px;margin-bottom:10px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(255,53,2);line-height:1.5">W3C 标准</span><sup style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;line-height:0;color:rgb(255,53,2)">[8]</sup></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;padding-top:8px;padding-bottom:8px;line-height:1.6;color:rgb(63,63,63);margin-top:10px;margin-bottom:10px"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;color:rgb(255,53,2);line-height:1.5">Vue 源码详解之 nextTick：MutationObserver 只是浮云，microtask 才是核心！</span><sup style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;line-height:0;color:rgb(255,53,2)">[9]</sup>（强烈推荐这篇文章）</p><h3 style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;margin-top:40px;margin-bottom:20px;font-weight:bold;line-height:1.5;color:rgb(63,63,63);font-size:120%"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;display:block">参考资料</span></h3><div style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;display:flex"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;display:inline;width:10%;background-image:none;background-position:initial;background-size:initial;background-repeat:initial;background-attachment:initial;background-origin:initial;background-clip:initial;font-size:80%;opacity:0.6;line-height:26px;font-family:ptima-Regular,Optima,PingFangSC-light,PingFangTC-light,&quot;PingFang SC&quot;,Cambria,Cochin,Georgia,Times,&quot;Times New Roman&quot;,serif">[1]</span><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;display:inline;font-size:14px;width:90%;line-height:26px;word-break:break-all">HTML 官方规范: <em style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-style:italic">https://html.spec.whatwg.org/multipage/webappapis.html#task-queue</em></p></span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;display:flex"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;display:inline;width:10%;background-image:none;background-position:initial;background-size:initial;background-repeat:initial;background-attachment:initial;background-origin:initial;background-clip:initial;font-size:80%;opacity:0.6;line-height:26px;font-family:ptima-Regular,Optima,PingFangSC-light,PingFangTC-light,&quot;PingFang SC&quot;,Cambria,Cochin,Georgia,Times,&quot;Times New Roman&quot;,serif">[2]</span><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;display:inline;font-size:14px;width:90%;line-height:26px;word-break:break-all">CSSOM 规范: <em style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-style:italic">https://drafts.csswg.org/cssom-view/#scrolling-events</em></p></span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;display:flex"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;display:inline;width:10%;background-image:none;background-position:initial;background-size:initial;background-repeat:initial;background-attachment:initial;background-origin:initial;background-clip:initial;font-size:80%;opacity:0.6;line-height:26px;font-family:ptima-Regular,Optima,PingFangSC-light,PingFangTC-light,&quot;PingFang SC&quot;,Cambria,Cochin,Georgia,Times,&quot;Times New Roman&quot;,serif">[3]</span><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;display:inline;font-size:14px;width:90%;line-height:26px;word-break:break-all">Issue: <em style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-style:italic">https://github.com/vuejs/vue/issues/3771#issuecomment-249692588</em></p></span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;display:flex"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;display:inline;width:10%;background-image:none;background-position:initial;background-size:initial;background-repeat:initial;background-attachment:initial;background-origin:initial;background-clip:initial;font-size:80%;opacity:0.6;line-height:26px;font-family:ptima-Regular,Optima,PingFangSC-light,PingFangTC-light,&quot;PingFang SC&quot;,Cambria,Cochin,Georgia,Times,&quot;Times New Roman&quot;,serif">[4]</span><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;display:inline;font-size:14px;width:90%;line-height:26px;word-break:break-all">MDN 文档: <em style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-style:italic">https://developer.mozilla.org/zh-CN/docs/Web/API/Window/requestIdleCallback</em></p></span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;display:flex"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;display:inline;width:10%;background-image:none;background-position:initial;background-size:initial;background-repeat:initial;background-attachment:initial;background-origin:initial;background-clip:initial;font-size:80%;opacity:0.6;line-height:26px;font-family:ptima-Regular,Optima,PingFangSC-light,PingFangTC-light,&quot;PingFang SC&quot;,Cambria,Cochin,Georgia,Times,&quot;Times New Roman&quot;,serif">[5]</span><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;display:inline;font-size:14px;width:90%;line-height:26px;word-break:break-all">幕后任务协作调度 API : <em style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-style:italic">https://developer.mozilla.org/zh-CN/docs/Web/API/Background_Tasks_API</em></p></span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;display:flex"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;display:inline;width:10%;background-image:none;background-position:initial;background-size:initial;background-repeat:initial;background-attachment:initial;background-origin:initial;background-clip:initial;font-size:80%;opacity:0.6;line-height:26px;font-family:ptima-Regular,Optima,PingFangSC-light,PingFangTC-light,&quot;PingFang SC&quot;,Cambria,Cochin,Georgia,Times,&quot;Times New Roman&quot;,serif">[6]</span><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;display:inline;font-size:14px;width:90%;line-height:26px;word-break:break-all">requestAnimationFrame: <em style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-style:italic">https://developer.mozilla.org/zh-CN/docs/Web/API/Window/requestAnimationFrame</em></p></span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;display:flex"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;display:inline;width:10%;background-image:none;background-position:initial;background-size:initial;background-repeat:initial;background-attachment:initial;background-origin:initial;background-clip:initial;font-size:80%;opacity:0.6;line-height:26px;font-family:ptima-Regular,Optima,PingFangSC-light,PingFangTC-light,&quot;PingFang SC&quot;,Cambria,Cochin,Georgia,Times,&quot;Times New Roman&quot;,serif">[7]</span><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;display:inline;font-size:14px;width:90%;line-height:26px;word-break:break-all">HTML 规范文档: <em style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-style:italic">https://html.spec.whatwg.org/multipage/webappapis.html#task-queue</em></p></span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;display:flex"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;display:inline;width:10%;background-image:none;background-position:initial;background-size:initial;background-repeat:initial;background-attachment:initial;background-origin:initial;background-clip:initial;font-size:80%;opacity:0.6;line-height:26px;font-family:ptima-Regular,Optima,PingFangSC-light,PingFangTC-light,&quot;PingFang SC&quot;,Cambria,Cochin,Georgia,Times,&quot;Times New Roman&quot;,serif">[8]</span><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;display:inline;font-size:14px;width:90%;line-height:26px;word-break:break-all">W3C 标准: <em style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-style:italic">https://w3c.github.io/requestidlecallback</em></p></span><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;display:flex"><span style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;display:inline;width:10%;background-image:none;background-position:initial;background-size:initial;background-repeat:initial;background-attachment:initial;background-origin:initial;background-clip:initial;font-size:80%;opacity:0.6;line-height:26px;font-family:ptima-Regular,Optima,PingFangSC-light,PingFangTC-light,&quot;PingFang SC&quot;,Cambria,Cochin,Georgia,Times,&quot;Times New Roman&quot;,serif">[9]</span><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;display:inline;font-size:14px;width:90%;line-height:26px;word-break:break-all">Vue 源码详解之 nextTick：MutationObserver 只是浮云，microtask 才是核心！: <em style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-style:italic">https://segmentfault.com/a/1190000008589736</em></p></span></div></div><h2 style="font-weight:400;margin:0;padding:0;max-width:100% !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;font-size:18px;letter-spacing:0.544px;white-space:normal;text-size-adjust:auto;border-width:0;border-style:initial;border-color:initial;word-break:break-all;line-height:110px;height:110px;color:rgb(100,159,12);text-align:center;background-image:url(https://mmbiz.qpic.cn/mmbiz_png/MpGQUHiaib4ib4f3Om1mUdknjChDIUNPFBdkz3eJIC2x34pMBwp7zSmPQm9k5g4zzPRxqR8BST3zmibkIRlR8XIc4g/640?wx_fmt=png);background-size:150px 110px;font-family:&quot;Helvetica Neue&quot;,Arial,&quot;Hiragino Sans GB&quot;,STHeiti,&quot;Microsoft YaHei&quot;;background-position:center center;background-repeat:no-repeat;box-sizing:border-box !important;overflow-wrap:break-word !important">关于奇舞团</h2><p style="margin:0;padding:0;max-width:100% !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;margin-bottom:20px;min-height:1em;letter-spacing:0.544px;text-size-adjust:auto;color:rgb(136,136,136);font-size:14px;font-family:&quot;Helvetica Neue&quot;,Arial,&quot;Hiragino Sans GB&quot;,STHeiti,&quot;Microsoft YaHei&quot;;line-height:2;white-space:pre-wrap;word-break:break-all;border-width:0;border-style:initial;border-color:initial;box-sizing:border-box !important;overflow-wrap:break-word !important">奇舞团是 360 集团最大的大前端团队，代表集团参与 W3C 和 ECMA 会员（TC39）工作。奇舞团非常重视人才培养，有工程师、讲师、翻译官、业务接口人、团队 Leader 等多种发展方向供员工选择，并辅以提供相应的技术力、专业力、通用力、领导力等培训课程。奇舞团以开放和求贤的心态欢迎各种优秀人才关注和加入奇舞团。</p><p style="margin:0;padding:0;max-width:100% !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em;letter-spacing:0.544px;white-space:normal;text-size-adjust:auto;color:rgb(0,0,0);font-family:-apple-system-font,&quot;Helvetica Neue&quot;,sans-serif;font-size:medium;text-align:start;box-sizing:border-box !important;overflow-wrap:break-word !important"><img src="%E6%B7%B1%E5%85%A5%E8%A7%A3%E6%9E%90%20EventLoop%20%E5%92%8C%E6%B5%8F%E8%A7%88%E5%99%A8%E6%B8%B2%E6%9F%93%E3%80%81%E5%B8%A7%E5%8A%A8%E7%94%BB%E3%80%81%E7%A9%BA%E9%97%B2%E5%9B%9E%E8%B0%83%E7%9A%84%E5%85%B3%E7%B3%BB.resources/640.jpg" height="318" width="922"/></p><p style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important;clear:both;min-height:1em"><br style="margin:0;padding:0;max-width:100% !important;box-sizing:border-box !important;-webkit-box-sizing:border-box !important;word-wrap:break-word !important"/></p></div></div><ul style="margin:0;padding:0"/><div style="margin:0;padding:0;padding-top:15px;overflow:hidden;line-height:32px;font-size:15px"><div style="margin:0;padding:0;display:flex"><div style="margin:0;padding:0;-webkit-box-flex:1;-webkit-flex:1;flex:1"><a href="https://mp.weixin.qq.com/s/ynLq8MjRLqX6uaYbK17n_Q##" style="margin:0;padding:0;color:#576b95;text-decoration:none;-webkit-tap-highlight-color:rgba(0,0,0,0);float:left;margin-right:16px">阅读原文</a></div><span style="margin:0;padding:0;float:right;margin-left:16px;color:#576b95;__visibility:hidden"><span style="margin:0;-webkit-appearance:none;-webkit-tap-highlight-color:rgba(0,0,0,0);outline:0;background-color:transparent;border:0;display:inline-block;vertical-align:middle;white-space:nowrap;padding:0;font-size:15px;font-family:inherit;line-height:2.13333333;color:#576b95"><span style="margin:0;padding:0">在看</span><span style="margin:0;padding:0;font-size:15px;margin-left:.2em"/></span></span></div></div></div></div></div></body></html>
<!DOCTYPE html>
<!-- saved from url=(0070)https://cdc.tencent.com/2020/05/22/frontend-state-management-research/ -->
<html lang="zh-cmn-Hans"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	
	<link rel="icon" href="https://cdc.tencent.com/wp-content/themes/cdc10th/favicon.ico" type="image/ico">
	<meta name="Description" content="腾讯CDC是一个设计团队，做世界一流的互联网设计团队，为用户创造优质在线生活体验。CDC关注于互联网视觉设计、交互设计、用户研究、前端开发。">
	<meta name="Keywords" content="cdc,blog,tencent design,tencent gui,tencent hci,tencent web">
	<meta id="author" content="Tencent CDC Team">
	<meta id="Copyright" content="Copyright 1998-2020 Tencent Inc. All Rights Reserved">
	<meta name="format-detection" content="telephone=no">
	<meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
	<meta name="verify-v1" content="eyIb7IlkT8vAK51fYxVlQPTG9xQWrF5dzXDyk6x7gMM=">
	<meta property="qc:admins" content="3065336343645635646375">
	<link rel="pingback" href="https://cdc.tencent.com/xmlrpc.php">

	<link rel="stylesheet" href="./前端状态管理设计——优雅与妥协的艺术 – 腾讯CDC_files/main.css">
	<link rel="stylesheet" href="./前端状态管理设计——优雅与妥协的艺术 – 腾讯CDC_files/swiper.min.css">
	<script src="./前端状态管理设计——优雅与妥协的艺术 – 腾讯CDC_files/jquery-1.12.3.min.9327.js"></script>
	<title>前端状态管理设计——优雅与妥协的艺术 – 腾讯CDC</title>
<link rel="dns-prefetch" href="https://s.w.org/">
<link rel="alternate" type="application/rss+xml" title="腾讯CDC » 前端状态管理设计——优雅与妥协的艺术评论Feed" href="https://cdc.tencent.com/2020/05/22/frontend-state-management-research/feed/">
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/12.0.0-1\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/12.0.0-1\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/cdc.tencent.com\/wp-includes\/js\/wp-emoji-release.min.js?ver=5.3.3"}};
			!function(e,a,t){var r,n,o,i,p=a.createElement("canvas"),s=p.getContext&&p.getContext("2d");function c(e,t){var a=String.fromCharCode;s.clearRect(0,0,p.width,p.height),s.fillText(a.apply(this,e),0,0);var r=p.toDataURL();return s.clearRect(0,0,p.width,p.height),s.fillText(a.apply(this,t),0,0),r===p.toDataURL()}function l(e){if(!s||!s.fillText)return!1;switch(s.textBaseline="top",s.font="600 32px Arial",e){case"flag":return!c([127987,65039,8205,9895,65039],[127987,65039,8203,9895,65039])&&(!c([55356,56826,55356,56819],[55356,56826,8203,55356,56819])&&!c([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]));case"emoji":return!c([55357,56424,55356,57342,8205,55358,56605,8205,55357,56424,55356,57340],[55357,56424,55356,57342,8203,55358,56605,8203,55357,56424,55356,57340])}return!1}function d(e){var t=a.createElement("script");t.src=e,t.defer=t.type="text/javascript",a.getElementsByTagName("head")[0].appendChild(t)}for(i=Array("flag","emoji"),t.supports={everything:!0,everythingExceptFlag:!0},o=0;o<i.length;o++)t.supports[i[o]]=l(i[o]),t.supports.everything=t.supports.everything&&t.supports[i[o]],"flag"!==i[o]&&(t.supports.everythingExceptFlag=t.supports.everythingExceptFlag&&t.supports[i[o]]);t.supports.everythingExceptFlag=t.supports.everythingExceptFlag&&!t.supports.flag,t.DOMReady=!1,t.readyCallback=function(){t.DOMReady=!0},t.supports.everything||(n=function(){t.readyCallback()},a.addEventListener?(a.addEventListener("DOMContentLoaded",n,!1),e.addEventListener("load",n,!1)):(e.attachEvent("onload",n),a.attachEvent("onreadystatechange",function(){"complete"===a.readyState&&t.readyCallback()})),(r=t.source||{}).concatemoji?d(r.concatemoji):r.wpemoji&&r.twemoji&&(d(r.twemoji),d(r.wpemoji)))}(window,document,window._wpemojiSettings);
		</script><script src="./前端状态管理设计——优雅与妥协的艺术 – 腾讯CDC_files/wp-emoji-release.min.js" type="text/javascript" defer=""></script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
	<link rel="stylesheet" id="wp-block-library-css" href="./前端状态管理设计——优雅与妥协的艺术 – 腾讯CDC_files/style.min.css" type="text/css" media="all">
<link rel="https://api.w.org/" href="https://cdc.tencent.com/wp-json/">
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://cdc.tencent.com/xmlrpc.php?rsd">
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://cdc.tencent.com/wp-includes/wlwmanifest.xml"> 
<link rel="prev" title="“万物有灵，飞禽走兽皆有情” 云游敦煌预热H5创作历程详解" href="https://cdc.tencent.com/2020/04/20/vvn/">
<link rel="canonical" href="https://cdc.tencent.com/2020/05/22/frontend-state-management-research/">
<link rel="shortlink" href="https://cdc.tencent.com/?p=11300">
<link rel="alternate" type="application/json+oembed" href="https://cdc.tencent.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fcdc.tencent.com%2F2020%2F05%2F22%2Ffrontend-state-management-research%2F">
<link rel="alternate" type="text/xml+oembed" href="https://cdc.tencent.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fcdc.tencent.com%2F2020%2F05%2F22%2Ffrontend-state-management-research%2F&amp;format=xml">
		<style type="text/css" id="wp-custom-css">
			/*
您可以在此处加入您的CSS。

点击上方的帮助图标来了解更多。
*/


		</style>
			<script>$ = jQuery;</script>
	<!--[if lt IE 10]>
		<link rel="stylesheet" href="https://cdc.tencent.com/wp-content/themes/cdc10th/css/ie.css"/>
	<![endif]-->
	<script src="./前端状态管理设计——优雅与妥协的艺术 – 腾讯CDC_files/launch-ENcebf21727597422daf93063125c20cf7.min.js"></script><script src="./前端状态管理设计——优雅与妥协的艺术 – 腾讯CDC_files/EXfe5e96445931443789a38cce36a67978-libraryCode_source.min.js" async=""></script>
</head>
<body class="have_search">
<!--[if lt IE 10]>
<div class="alert-danger" role="alert">你的浏览器实在太太太太太太旧了，放学别走，升级完浏览器再说！<a target="_blank" class="alert-link" href="http://browsehappy.com">立即升级</a></div>
<![endif]-->

<div class="g-header header-show">
	<div class="g-container">
		<div class="g-logo">
			<a href="https://cdc.tencent.com/" hidefocus="true">腾讯CDC</a>
		</div>
		<div class="g-nav"><ul id="menu-index_nav"><li id="menu-item-8925" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-8925"><a href="http://cdc.tencent.com/" hidefocus="true">首页</a></li>
<li id="menu-item-8930" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children menu-item-8930"><a href="https://cdc.tencent.com/2020/05/22/frontend-state-management-research/#" hidefocus="true">工具</a>
<ul class="sub-menu">
	<li id="menu-item-8931" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-8931"><a target="_blank" rel="noopener noreferrer" href="http://wj.qq.com/" hidefocus="true">腾讯问卷</a></li>
	<li id="menu-item-8932" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-8932"><a target="_blank" rel="noopener noreferrer" href="http://idesign.qq.com/" hidefocus="true">设计导航</a></li>
	<li id="menu-item-11196" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-11196"><a href="https://txc.qq.com/" hidefocus="true">腾讯兔小巢</a></li>
</ul>
</li>
<li id="menu-item-8929" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-8929"><a href="https://cdc.tencent.com/about/" hidefocus="true">我们</a></li>
<li id="menu-item-9050" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-9050"><a href="https://cdc.tencent.com/%e6%8b%9b%e8%81%98/" hidefocus="true">招聘</a></li>
</ul></div>		<div class="g-info">
			<ul class="g-follow">
				<li class="wechat">
					<a href="javascript:;" hidefocus="true">
						<i class="icon"></i>
						<span>CDC官方公众号</span>
					</a>
					<div class="wechat-qr">
						<img src="./前端状态管理设计——优雅与妥协的艺术 – 腾讯CDC_files/wechat-qr-code.png" alt="CDC官方公众号">
						<p>CDC官方公众号</p>
					</div>
				</li>
				<li class="rss">
					<a target="_blank" href="https://cdc.tencent.com/feed/rss/" hidefocus="true">
						<i class="icon"></i>
						<span>RSS</span>
					</a>
				</li>
			</ul>
			<div class="g-search">
				<button class="search-trigger" type="button" title="搜索">搜索</button>
				<div class="search-box">
					<div class="search-form">
						<button class="search-submit">搜索</button>
						<input type="text" class="search-input" placeholder="请输入想要搜索的内容">
						<button class="search-close">关闭</button>
					</div>
					<div class="search-suggest">
						<!-- <p class="title">历史搜索：</p> -->
						<ul>
														<li><a href="https://cdc.tencent.com/?tag=%E8%A7%86%E8%A7%89%E8%AE%BE%E8%AE%A1" hidefocus="true">视觉设计</a></li>
														<li><a href="https://cdc.tencent.com/?tag=%E4%BA%A4%E4%BA%92%E8%AE%BE%E8%AE%A1" hidefocus="true">交互设计</a></li>
														<li><a href="https://cdc.tencent.com/?tag=%E7%94%A8%E6%88%B7%E7%A0%94%E7%A9%B6" hidefocus="true">用户研究</a></li>
														<li><a href="https://cdc.tencent.com/?tag=%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91" hidefocus="true">前端开发</a></li>
													</ul>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>


<div class="article-page g-container">
		<div class="article-details">
		
<!--== 文章内容 ==-->
<div class="content-details">
	<div class="content-title">
		<h3>前端状态管理设计——优雅与妥协的艺术</h3>
		<a href="https://cdc.tencent.com/?cdc_author=frustigor" class="avatar" hidefocus="true"><img src="./前端状态管理设计——优雅与妥协的艺术 – 腾讯CDC_files/no_avater.png" alt="frustigor"></a>
		<p>
			<span><!-- <a href="https://cdc.tencent.com?cdc_author=frustigor"> -->frustigor<!-- </a> --></span>
			2020.05.22		</p>
		<ul>
			<li class="count-browse"><span>695</span></li>
			<li class="count-like"><span>0</span></li>
			<li class="count-comment"><span>0</span></li>
		</ul>
	</div>
	<div class="content-banner">
		<img src="./前端状态管理设计——优雅与妥协的艺术 – 腾讯CDC_files/saved_resource" alt="">
	</div>
	<div class="content-text">
		<p>如果我仍然去解释什么是状态管理器，为什么我们需要它，这篇文章将会索然无味。我的想法是，我们原本不需要状态管理器，但我们确实需要状态管理。</p>
<h2>前端状态管理</h2>
<p>非要去深究“状态”这个词，从后端服务的角度去解释更加能让我们理解。一言概之，我自以为是地总结，“状态”的意思就是：现在的样子。一个服务现在的样子主要是由运行时所产生的内存和运算决定的，而且，它有终极的时间观念，理论上任何时刻的状态都不同，因为它内部必然会有即使细微的变化。</p>
<p>前端状态管理这个概念出现之前，就已经有状态管理的实践了。我在2010年开始使用jquery，这是一个非常了不起的库，它将复杂的DOM操作，通过简化和封装，成为实质上的行业标准。HTML5标准发布后，采用了querySelector这个接口，可以说它完全是基于开发者对jquery的认可度的考虑。那这和状态管理有什么关系呢？我想说的是，在jquery的年代，虽然“前端状态管理”这个概念还没有产生，但是状态管理确真实存在。我们用一段基于jquery的伪代码来看看。</p>
<pre><a href="http://cdc.tencent.com/%e6%89%b9%e6%b3%a8-2020-05-22-132730/" rel="attachment wp-att-11302" hidefocus="true"><img class=" wp-image-11302 alignnone" src="./前端状态管理设计——优雅与妥协的艺术 – 腾讯CDC_files/批注-2020-05-22-132730.png" alt="" width="568" height="244" srcset="https://cdc.tencent.com/wp-content/uploads/2020/05/批注-2020-05-22-132730.png 802w, https://cdc.tencent.com/wp-content/uploads/2020/05/批注-2020-05-22-132730-768x330.png 768w" sizes="(max-width: 568px) 100vw, 568px"></a></pre>
<p>我们在实践中，使用dataset的特性，直接在被操作的DOM节点上对一个模态框的隐现<em>状态</em>进行管理。而在其他地方，我们可能会读出这个状态值，用来判断是否要执行某些操作。</p>
<p>你看到的这种操作，在我们将“前端状态管理”的概念抽象化之前，几乎随处可见。当然，这是一种原始的状态管理，它只能处理单一的、分散的、临时的状态，无法对复杂的、耦合（依赖）的、持久的状态进行深度处理，或者说处理起来很麻烦。其中的典型案例就是我多次提及的表单业务，在一个表单业务中使用jquery进行开发，所有的表单数据，必须分散的、随意的，提交的时候，必须从很多个地方把这些数据找出来，甚至还比较难找。</p>
<p>我们不禁要问：状态管理的本质是什么？起码，在这一阶段，我们已经知道一个事实：</p>
<h3># 某一状态能够被有效记录。</h3>
<p>我大学本科和硕士所属专业的大类学科是管理学，不同专业对管理的解释不同，而对我而言，记录则是一种有效管理。就像jquery时代，我们找到一种虽然原始，但行得通的方式管理状态。</p>
<p>但是，我们往往发现，我们正在实践的东西，有些是非常优秀的，但是，必须等到很多年（3-5年）之后，被其他团队的某个项目带热之后，才证明我们正在实践的东西是对的，是走在趋势上的，然而我们没有坚持到最后，因为最后我们采用了市面上最热门的框架或库。超前的东西往往一开始有很多人同时实践，但是随着时间流逝，这些实践的人中，很多退出了，在沉寂的发展中，会有一些坚持下来的团队，最终成为主流，比如angularjs团队。但不要着急，在angularjs还默默无闻时，甚至已经初露端倪时，仍然还是jquery的天下，直接对DOM节点操作的前端编程范式持续了至少6年，直到react提出virtual dom这样先进的理念之后，jquery才逐渐淡出历史舞台。angularjs团队至始至终都没有超出jquery的统治高度。</p>
<p>没有超出jquery统治高度的，还有backbone。我也多次提到过这个库，它至今还活着，你可以通过<a href="https://backbonejs.org/" hidefocus="true">这里</a>查看它的文档。backbone的成就核心在于它的Model（backbone是一个真正意义上的前端框架，但是它不处理view部分，它提供了view的编程范式，但你需要使用jquery来完成所有view的更新）。我们来看一个例子吧。</p>
<pre><a href="http://cdc.tencent.com/2020-05-22-132732/" rel="attachment wp-att-11303" hidefocus="true"><img class=" wp-image-11303 alignnone" src="./前端状态管理设计——优雅与妥协的艺术 – 腾讯CDC_files/2020-05-22-132732.png" alt="" width="576" height="236" srcset="https://cdc.tencent.com/wp-content/uploads/2020/05/2020-05-22-132732.png 887w, https://cdc.tencent.com/wp-content/uploads/2020/05/2020-05-22-132732-768x314.png 768w" sizes="(max-width: 576px) 100vw, 576px"></a></pre>
<p>backbone中可没有我们现在熟知各种花里胡哨的操作方式，对于模型实例中的状态，只能通过get进行获取，通过set进行修改，set也支持传入对象批量修改。而它最大的亮点，在于模型上的on方法，这个方法实现了状态管理的一个质变。</p>
<h3># 状态的变化能被有效感知和响应。</h3>
<p>on/off这对监听方法来源于jquery，但超越了jquery。jquery中只针对DOM的事件系统，而backbone可以脱离DOM，对数据变化进行监听。当数据的变化被监听之后，就可以在监听函数中对view进行修改，而对于事件的响应，只需要调用set方法修改数据。这样就做到了数据和界面代码的分离解耦，是一大进步。但backbone也止步于此。</p>
<p>使用set/get这种接口方法显然是一种妥协，而且不符合习惯的还有必须加一个<code>change:</code>前缀，以和普通事件区分。如果回到2018年去重新设计backbone，get可以做依赖收集，监听可以被优化，即使仍然采用set/get接口，而不采用defineProperty这样的黑魔法，也可以再进一步，然而，时代终将止步于该止步之处。</p>
<p>对于开发者而言，虽然可以通过对状态变化的监听，来实现状态和界面代码分离，却最终只能通过set/get这样的方法接口进行数据操作，有违编程的优雅。在这条路上，angularjs走的更远。同样是基于jquery打下的江山，backbone也是框架，angularjs也是框架，然而当我们如今回头去看，虽然angularjs也没有爆红，却踏踏实实的，成为一代框架典范，成为前端工程化之鼻祖，同时，也是前端状态管理的一大遗憾。</p>
<p>如果你使用过angularjs，你会喜欢上它，当然前提是在那个年代。它通过一套被称为脏检查机制的响应系统，让开发者可以通过直接修改状态属性值，就可以改变界面。我们来看下代码。</p>
<p><a href="http://cdc.tencent.com/2020-05-22-133323/" rel="attachment wp-att-11304" hidefocus="true"><img class=" wp-image-11304 alignnone" src="./前端状态管理设计——优雅与妥协的艺术 – 腾讯CDC_files/2020-05-22-133323.png" alt="" width="548" height="221"></a></p>
<pre></pre>
<p><code>$scope</code>&nbsp;是angularjs的内置服务，为了避免一些作用域问题，推荐使用controllerAs来管理。但我们且不去讨论这些问题，我们看angularjs的代码，已然见到来当代所熟悉的编程风格了。我们可以把$scope当作是一个状态的容器，状态变化，会通过angularjs的响应系统，反馈到界面上去，view中所使用的数据素材，和$scope上的属性名完全对应。</p>
<h3># 状态的改变能驱动界面的变化。</h3>
<p>angularjs的实现原理是，在ng-click的触发之后，除了调用执行<code>$scope.updateName</code>之外，实际上还要执行内部的digest循环过程，也就是脏检查的内部实现。只有经历完这个digest之后，才能更新视图界面。那么问题就由此而生，在有些情况下，这个digest确实没有被触发，举个例子，在原生的ajax请求结束时修改$scope.name就无法触发，于是angularjs提供了$apply方法解决这个问题。</p>
<pre><a href="http://cdc.tencent.com/2020-05-22-133324/" rel="attachment wp-att-11305" hidefocus="true"><img class=" wp-image-11305 alignnone" src="./前端状态管理设计——优雅与妥协的艺术 – 腾讯CDC_files/2020-05-22-133324.png" alt="" width="367" height="76"></a></pre>
<p>不过，一个angularjs的应用，它的controller逐渐膨胀，慢慢的随着业务逻辑的增长，一个function被撑到上千行代码也有可能。而在这上千行代码中，要找到一个状态以及这个状态的变化过程，犹如在大海中寻找绣花针般，无计可施。</p>
<p>问题出在哪里呢？直到今天，angular已经迭代，旧版本几乎已经停止维护，这个问题仍然没有被回答。我个人猜测，最本质的根源在于，angularjs没有按照严格的MVC进行设计，它缺失了M层，所有的编程逻辑被写在controller函数中，任由开发者自由发挥，修改状态来驱动视图更新。由于没有对Model层进行强约束，导致代码里根本分不清哪些是用于控制视图变化的交互逻辑，哪些是用于控制数据变化的业务逻辑。而这个问题，在后来的react、vue中其实也存在。</p>
<p>一个更严重的问题，angularjs的directive（相当于组件）支持双向数据绑定，导致外层状态在内层directive中被修改，在调试问题时，由于无法掌握状态变化的顺序，使开发者可以崩溃到砸电脑状态。并且随着W3C标准的推进，“组件”这个概念开始慢慢成为开发的核心概念。而于此同时，同样基于组件思想而生的react就像横空出世一样，像一记银弹击碎了jquery多年美梦，从此前端编程范式实现了转变。</p>
<p>react的编程范式核心来自virtual dom，虚拟DOM的思想直接使得前端编程范式发生转变。通过将DOM树映射到一个内存对象，通过对虚拟DOM的对比，只更新实际DOM中的少量节点，从而避免频繁操作DOM带来的性能损耗。但virtual dom的杀手锏在于，将实际的DOM抽象为虚拟DOM之后，虚拟DOM是否再回到实际DOM就是可选择的事情，因为基于这套理论，虚拟DOM还可以为其他渲染方式提供驱动力，比如react-native，或者渲染canvas。而驱动virtual dom发生变化的，竟然是状态。这是一个颠覆性的质变。</p>
<p>react一直提倡一种纯UI组件，这种组件完全受控于其接收的props的值，像纯函数一样，props在解构全等的情况下，其渲染出来的效果是一模一样。而支配props变化的，来自于顶层组件一层一层的传递。最终，一个界面将要展示成什么样子，取决于一个状态，由这个状态参与组成虚拟DOM，并反映到真实DOM中去。状态发生变化时，按照一层一层传递的单向数据流方式，让所有的自组件按照最顶层组件的状态进行渲染。</p>
<h3># 界面是状态的映射。</h3>
<p>在这种思想熏陶下，大约2016年，整个前端的编程范式都以此为基础，所涌现出来的vue，也直接借鉴这套思想进行编程。一个状态，对应一个界面，这简直是天才的想法。基于这种思想，把所有的状态按照时间线录制下来，就可以重放界面变化的所有，这种录制，将原本庞大的界面数据，抽象为状态这一小量数据，这种思维在游戏录制领域也被使用过。</p>
<p>诚然，虽然“映射”思想颠覆了传统前端编程更新DOM的范式，但react的编程范式所遵循的单向数据流却带来了巨大麻烦。这种一层一层传递的方式，虽然保证了“映射”行为的纯正性，但无法适应实际生产过程中所带来的coding和debug麻烦的问题。如果由于一个点击操作需要通过10层组件的传递，才能对点击做出响应，那么很可能就会出问题。单向数据流听起来让数据流很清晰，但是对应到代码中，发生一个事件发生后，这个事件信息，被如何传递，成为极其复杂的代码逻辑，那么看似明晰的清流，就变成了汹涌的浊流。</p>
<p>中心化的状态管理孕育而生，redux、mobx这些都是佼佼者。这些，就是我们当代真正意义上所称的状态管理器。它们当然是为了管理状态。redux是一朵奇葩，它火，火到爆炸，但是你去阅读它的源码，却又很简单。大道至简，在这些年的编程体验中，我逐渐体会到，<strong>简单，是一切的根本</strong>。redux的使用非常简单，接口就那么几个。然而，它却衍生出了自己的生态，它把自己的概念体系发展成为蓬勃的森林。我的天！原本简单的东西，非要通过概念复杂化。<strong>设计，核心是简单，工具，用完即走就行。</strong>同样的错误，mobx重蹈覆辙。它的设计理念也非常的具有颠覆性，引入观察者模式，将状态的变化通过观察者模式进行抽象，并且通过完美的封装，使得更新状态的方式和普通修改一个对象没有两样。然而，过渡设计让开发者望而却步。不过话说回来，在状态管理这个点上，它们的核心思想保持了一致，都是：</p>
<h3># 集中管理状态，共享状态。</h3>
<p>集中管理实际上是共享的前提，但也超越了共享这一单项功能，集中管理状态，可以用一个状态，概括一组组件，甚至一个应用的整体状态。在映射思维驱动之下，连路由也要状态化，也就是说，整个应用的一切行为都由中心化的状态管理器决定。框架层、UI层只是应用的壳，而状态以及状态的驱动才是应用的魂。状态管理器，通过连接器将状态的变化反馈到具体的某个组件中，而这个组件，可以通过原本的单向数据流将状态传入更深的子组件中。UI层像提线木偶一样，被状态管理器完完全全的控制着。</p>
<p>然而，物极必反。react官方提出来的flux，本身就打破了单向数据流的体系，它使数据可以通过多条管道进行传递，而它的核心，就是要建立一条便捷通道，跨过多层组件，使分散在两个树枝上的节点组件直接通信。虽然flux通过非常复杂的概念，试图解释自己是遵循单向数据流，但是不可否认，它只是在原来的单向流之外，又开了一条流，现在有两条通道，但你只能选择其中之一，这样你才能单向数据流，从而保证界面和状态之间的映射关系。而且，基于context的技术是react官方给出的，flux是妥协的产物，它是为了解决react带来的问题而产生的，而很不幸，为了解决这个问题，flux带来了更多的问题，<strong>妥协，本质上是债务</strong>。</p>
<p>更致命的是，中心化的状态管理面临严重的问题。状态，本身是必要的。状态解决了临时保持和最终决定两个环节的冲突，以HTML中的select标签（本质就是一个组件）为例子，哪一个option被选中了呢？这得看当前select的状态，但这并不代表当前被选中的值将作为你最终提交的值，你提交的值，往往是看不见的option的value属性值。同样的情况比比皆是，例如你需要打开一个模态框，在里面输入东西，或者选择选项，但是模态框会给你一个cancel的能力，当你点击cancel的时候，之前的操作会被重置。而这些临时保持的状态，根本没有必要进入中心化管理的状态管理器中，一旦进入中心化状态管理器，那么就遇到内存持久不能释放，还要解决数据重置等问题。但尴尬的场景又在于，如果不进中心化状态管理器，那映射思想又无法完全实现，一个状态一定对应一个界面的理想模式无法复现。这个问题，只要是共享数据，都会碰到，不一定是共享状态，共享一个函数，共享一个模块，共享一个类的实例，都会遇到，所以，这是共享问题带来的普遍性问题。</p>
<p>还有一个大问题，集中管理状态的代价是状态的domain问题。一份完整的状态确实好处多多，但是带来的问题是，原本和组件无关的状态变化，也会因为状态整体的变化被通知重新执行virtual dom的diff操作。不过这是有办法解决的，无论是通过状态管理器自身的优化也好，还是通过组件的优化也好，都可以做到根据需要的状态变化来决定自身是否要做这个diff。可是大状态始终是个隐患，不仅面临内存问题，也面临数据重复、难相互依赖等问题。</p>
<p>直到react hooks出现，这个局面又被打破。hooks虽然表面上是让functional组件也可以在不同的生命周期环节上执行某些任务，但是本质上是重新定义组件在什么情况下重新diff。hooks函数的重点不在第一个参数，而在第二个参数（依赖）。当依赖发生变化时，需要执行对应的变化。变化源自状态的变化。hooks依赖状态，但是实际上定义的是动作及其触发的条件。</p>
<h3># 状态不是状态，而是动作。</h3>
<p>从更小粒度去解释，视图层的每一个变化，是完成什么动作。这就是hooks带来的变化。这个粒度小到什么程度呢？atom。Recoil是facebook发布的一个状态管理工具，基于hooks的技术，实现状态共享。和集中管理状态不同，recoil是小到原子级别的状态管理。通过atom定义一个原子状态，通过selector定义一个依赖原子状态的复合状态（相当于计算属性），再依托hooks，实现状态共享。由atom定义的原子状态，它的状态到底是什么并不重要，我们不需要取出来看看，我们要做的，是在hooks加持下，把握住状态变化的所带来的影响，也就是每一个动作。</p>
<p>听上去就像在胡扯，事情会变得越来越复杂。设计，核心是简单。这里的简单，不单单是使用起来很简单，而且理解起来也要很简单。对于一个工具而言，我们要<strong>止于至简</strong>。我们追求简单，但防止过犹不及。在设计工具时，有的时候，我们可以设计出超强超灵活的能力，但是，超出简单部分的功能，往往使得使用成本和理解成本极速上升。状态管理器的本质，是管理状态，是共享状态。过度设计，过度技术化，都是过犹不及。当recoil发布的时候，大家开始讨论actor model，这是过犹不及。我们做开发设计，并非遵循某个模型进行设计，而是遵循使用者的使用习惯进行设计。当然，我不是说要迁就使用者，而是说让使用者付出最低的成本得到最高的回报，简单原则是达到这一目标的终极武器。为了简单，我们有的时候不得不放弃一些原本可以让工具更强大的能力，但是不要着急，这给我们开发工具提出了另外一个要求，就是扩展性。简单是对使用者说的，而扩展性则是对开发者说的。通过扩展性，简单工具可以变成功能强大的功能，扩展性设计是考验能力的，并非每个开发者都能做到，但是，这是基本面。</p>
<h2>挑选优质特性</h2>
<p>应用没有“有意识地管理状态”并非不行，以最早的jquery.data方式管理一个状态也未尝不可。但如果需要有意识的进行状态管理，那么，我们不得不需要一个状态管理器。虽然我们可以挑选市面上已有的状态管理器，但我们可能并不需要。我认为redux之所以经久不衰，核心的核心就在于简单。然而，并不是简单我们就一定要用它，如果它的简单正好符合我们的实践场景，那么它是不二之选，但是它的简单在应对我们的场景的时候略有不足，由于木桶原理，它将永远无法满足我们的要求。所以，手撸状态管理器在所难免。</p>
<p>当然，我们手撸，并不代表我们要全撸，例如，我们可以基于已有的redux，利用它的扩展性，撸出自己的状态管理器。然而核心要点还是在于，如何提供低成本的使用者开发体验。我们基于redux撸出来的，我们可以另外取一个名字，将我们的用法和接口暴露给使用者，我们全然不提redux，使用者但凡用的舒服，没有吐槽，就代表这是成功的，此时我们再提redux，会让我们的成果充满乐趣。而如果一开始就大书特书我们是基于redux的，想加持光环，那么得到的结果必然是，如若不是真的好用到爆炸，断然收不到好评。</p>
<p>既然要开始撸状态管理器，我们就要设计这个状态管理器的核心特质，缺少这些特质会是我们自己都无法忍受的。</p>
<ul class="list-paddingleft-2">
<li>简洁的状态定义，拒绝reducer</li>
<li>状态domain，拒绝庞大状态树的细小变动都惊动整个virtual dom重新计算</li>
<li>回溯能力，可撤销变化</li>
<li>重放能力，整个应用可以根据时间线完整播放</li>
<li>局部状态可销毁，以释放内存</li>
<li>局部的共享，基于某一系列流程的临时状态，当这一系列流程结束时，共享状态可销毁</li>
<li>同时支持hooks和class components</li>
<li>简洁的状态更新方式，深层节点更新不需要写非常复杂的解构</li>
<li>优雅的异步支持</li>
</ul>
<p>其中，简洁的状态更新方式有一个库可以推荐：immer。这个库只有一个接口，它的使用方式如下：</p>
<pre><a href="http://cdc.tencent.com/2020-05-22-133325/" rel="attachment wp-att-11306" hidefocus="true"><img class=" wp-image-11306 alignnone" src="./前端状态管理设计——优雅与妥协的艺术 – 腾讯CDC_files/2020-05-22-133325.png" alt="" width="580" height="56" srcset="https://cdc.tencent.com/wp-content/uploads/2020/05/2020-05-22-133325.png 808w, https://cdc.tencent.com/wp-content/uploads/2020/05/2020-05-22-133325-768x74.png 768w" sizes="(max-width: 580px) 100vw, 580px"></a></pre>
<p>大道至简！大道至简！大道至简！immer的作者简直就是天才。使用immer遵循了immutable的社区范式，同时又可以采用mutable的操作方式，虽然在实战中确实还有些坑，然而，对比原本写一大堆解构符号的做法，这个接口简直是上帝的馈赠。</p>
<p>还有一个点需要单独指出，重放功能实际上并不是强制的，因为对于大多数应用而言，要实现完全的重放，其实是不大可能的，最严重的原因有两点：1）我们无法穿透所有组件，在大部分组件中，我们不可避免的会用到内部状态，而这些内部状态的变化我们无法收集到，因此，也就无法重放由于组件的内部状态变化带来的界面变化，一旦无法重放界面变化，就会出现问题，因为DOM的变化具有副作用，下一个DOM树的基础是上一个DOM树，如果某些变化没有发生，后续变化所依赖的DOM节点可能根本就不存在，应用会报错；2）在状态中，我们不可避免的使用某些实例对象，基于class的实例对象有内存依赖，我们无法将它们保存到服务器端，再从服务器端拉出来进行回放。由于这两个原因，实际上要完全回放一个应用，是很难的。</p>
<h2>有没有其他方向？</h2>
<p>有的。我们谈状态管理，本质上无法摆脱应用层面的架构思维，而且这里仅仅是指围绕数据流的前端应用（Management System、Data Application），我们几乎很少在游戏这种视觉系统中大谈前端状态管理。既然是Management System，那么我不禁要问，状态管理的目的，是技术的，还是应用的？很显然，状态管理的目的，是为了让应用系统良好运作，保障系统工作稳定准确。而我们要面对的实际情况是什么呢？并非如何在组件之间共享状态。我们的实际情况是，我们需要在不同子模块之间协调，甚至，我们需要在不同的客户端之间协调。这里面的核心点实际上是“业务逻辑”。如果我们同时拥有手机端和PC端应用，虽然它们在视图层面完全不同，然而在business层面，却是一定一致的，否则系统就不可靠了。如何保障业务层面的一致性呢？</p>
<p>对于服务端应用而言，特别是今天这个时代，分布式系统已经是基础范式了，多个节点如何保障同一个用户的业务操作是一致的，实际上，它们还是要共享一个状态，这个状态可能存在redis中，可能通过Kafka进行同步。业务逻辑的推进，依赖这些状态。看看后端是怎么处理的？在模型中专注于整理出每一个业务原子操作，并在接收到特定事件（或请求）时，按照业务顺序，组装完整的业务逻辑出来。而现在前端是怎么做的？以react为例，几乎全部的react应用，都是将业务逻辑写在组件中，因为业务操作必须依赖用户的操作，而用户的操作必须在视图层中予以反馈。所以在react组件中写业务逻辑非常正常，这回到了angularjs的老路子上，特别是强调functional+hooks的写法之后，我很容易想象到未来的react组件和angularjs的controller函数差不多，写出上千行代码也不是不可能，到时候没人敢动这个组件。</p>
<p>而在这一点上，我恰恰发现vue比react好很多。vue的结构是&lt;template&gt;&lt;script&gt;&lt;style&gt;，这样的结构看上去符合早期的编程习惯，模板样式加脚本嘛！然而，如果再去琢磨vue的script部分，我发现实际上vue所export出去的对象，本质上是一个类似模型的定义（类似配置对象）。</p>
<pre><span style="color: #000000;">{
  data,
  computed,
  methods,
  watch,
}</span></pre>
<p>一个模型，总是围绕自己目标所需要的数据进行处理。如果写过php应用，大部分php框架都会有模型层，而在编写模型时，强调的，都是只进行数据的读写和计算，而不处理任何视图的东西，处理视图的东西，需要在控制器中读取模型上的数据，自己进行组装。所以，模型，是对单一目标数据的总体概括，具有业务逻辑的抽象性，无法单独完成整个业务流程，但是却规定了业务逻辑的核心部分，等待开发者使用这些部分，组装出完整的业务流程。</p>
<p>不过，vue的组件定义不仅仅包含这些东西，同时还有生命周期函数，子组件引用，props，视图事件回调函数等等东西，而这些东西的整体，又是为视图编程服务的，因此，最终它和模型也只是插肩而过。状态管理的下一个方向，我恰恰认为是去弥补这个领域。前端架构至始至终，都没有在模型层抽象出犹如后端一致的模型管理，而发展至今，也应该是时候去往这个坑填一填了。所以，我在写完react-tyshemo之后，有一种自豪感。我感觉自己好像触摸到一点点这个问题的边缘了。这个库，可以做到定义状态就定义状态，在定义函数中，把状态的所有演变都定义完整（也就是和上述vue组件script中的部分子集一致），然后通过connect注入给组件使用，对于组件而言，它就像只能从模型中读取属性和方法一样，在遇到对应的交互事件之后，调用模型上的方法去驱动模型中的状态变化，然后返回来又更新自己。这样就做到了数据模型的定义和视图层（react组件）的分离，在手机端、PC端之间共用同一个模型成为可能。</p>
<p>在react生态里面，炫技的不在少数。但要解决问题，而且要简单地解决问题。将状态管理升级到前端模型构建之后，模型逻辑和视图逻辑就可以完全分离。而由于我们大部分情况下，会在模型中写业务逻辑，在视图中写交互逻辑，所以只需要将它们组装起来。但是，有趣的地方在于，可以拆分开来。而且，这也带来了另一个好处，由于业务逻辑的部分被独立出来，那么在不同端，就可以被复用，手机端、PC端、其他端，可以基于同一个模型，但视图却可以不同，视图因为只负责交互逻辑，所以反而更抽象，变量命名都可以抛开业务单词使用更抽象的词汇来命名。一旦业务逻辑的东西通过模型层面，和react视图编程拆分开，那么，真的就可以做到，react组件负责纯UI，而模型负责纯业务逻辑，中间在通过某种控制器将两者粘连在一起，会是另一翻编程的景象。</p>
<h2>最后语</h2>
<p>本文主要是想表达，在状态管理这件事上，我们尝试一切，试图找到某种通用的优雅的解决方案，但是，在所有方案中，我们都不得不进行一些妥协。如果我们能够从历史的角度去观察，往往能够发现，世界上没有完美的事物，有一种说法“历史都是妥协出来的”，我们可以换一个好听的词，叫“博弈”，但是无论如何，我们都在追求着，每个人的追求不同，代码风格的优雅，代码量少，代码性能极致，代码明显没有bug……这些追求，驱动着我们不断探索和思考。</p>
<p><a href="http://cdc.tencent.com/cdc-blog-%e5%ba%95%e9%83%a8%e4%ba%8c%e7%bb%b4%e7%a0%81-2/" rel="attachment wp-att-11297" hidefocus="true"><img class="aligncenter size-full wp-image-11297" src="./前端状态管理设计——优雅与妥协的艺术 – 腾讯CDC_files/CDC-Blog-底部二维码.png" alt="" width="2880" height="1020" srcset="https://cdc.tencent.com/wp-content/uploads/2020/04/CDC-Blog-底部二维码.png 2880w, https://cdc.tencent.com/wp-content/uploads/2020/04/CDC-Blog-底部二维码-768x272.png 768w, https://cdc.tencent.com/wp-content/uploads/2020/04/CDC-Blog-底部二维码-1536x544.png 1536w, https://cdc.tencent.com/wp-content/uploads/2020/04/CDC-Blog-底部二维码-2048x725.png 2048w" sizes="(max-width: 2880px) 100vw, 2880px"></a></p>
	</div>

	
	<div class="content-more">
		<p>感谢你的阅读，本文出自<a href="http://cdc.tencent.com/" hidefocus="true"> Tencent CDC</a>，转载时请注明出处，谢谢合作。<br>格式为：Tencent CDC（<a href="https://cdc.tencent.com/2020/05/22/frontend-state-management-research/" hidefocus="true">https://cdc.tencent.com/2020/05/22/frontend-state-management-research/</a>）</p>
	</div>
	<div class="content-prevnext">
		<p>上一篇: <a href="https://cdc.tencent.com/2020/04/20/vvn/" rel="prev" hidefocus="true">“万物有灵，飞禽走兽皆有情” 云游敦煌预热H5创作历程详解</a></p>
		<p class="next-page"></p>
	</div>
</div>


<!--== 分享模块 ==-->
<div class="content-share">
	<ul>
		<li><a href="https://cdc.tencent.com/2020/05/22/frontend-state-management-research/##" data-action="https://cdc.tencent.com/wp-content/plugins/cdc/cdc_api.php?method=cdc_like" data-post-id="11300" class="btn-like" hidefocus="true">喜爱</a></li>
		<li>
			<a href="javascript:;" class="btn-share" hidefocus="true">分享</a>
			<div class="share-list">
				<em>分享到...</em>
				<p class="share-box share-item-list"><span class="weixin-qrcode"><a href="javascript:;" class="share-item share-weixin" data-type="weixin" title="扫一扫分享到微信" hidefocus="true">微信</a><div class="qrcode" id="qrcode"><canvas width="170" height="170"></canvas></div></span><span><a href="javascript:;" class="share-item share-qzone" data-type="qzone" title="分享到QQ空间" hidefocus="true">QQ空间</a></span><span><a href="javascript:;" class="share-item share-weibo" data-type="weibo" title="分享到新浪微博" hidefocus="true">新浪微博</a></span><span><a href="javascript:;" class="share-item share-qqweibo" data-type="qqweibo" title="分享到腾讯微博" hidefocus="true">腾讯微博</a></span></p>
				<button class="close">关闭</button>
			</div>
		</li>
	</ul>
</div>


<link rel="stylesheet" href="./前端状态管理设计——优雅与妥协的艺术 – 腾讯CDC_files/coral_v9.6.6.css">
<link rel="stylesheet" href="./前端状态管理设计——优雅与妥协的艺术 – 腾讯CDC_files/coralImg.css">
<style type="text/css">
	#top_reply h1 span{float:left;font-size:13px;margin-left:10px;color:#c2c0c0}
	#top_reply h1 span a:hover{color:#df7070}
	#top_reply h1 span a{color:#c2c0c0;font-size:13px}
</style>
<link href="./前端状态管理设计——优雅与妥协的艺术 – 腾讯CDC_files/minicss2.css" rel="stylesheet" type="text/css" media="screen">
<script src="./前端状态管理设计——优雅与妥协的艺术 – 腾讯CDC_files/sea.js"></script> <!--引入seajs-->


    <div id="mainBody" class="np-frame" style="width: 100%;">

        <!--评论框 -->

        <div id="top_reply">

            <h1 class="np-title">
                <em id="commentTotleNum" target="_blank"></em>
                <strong>评论</strong>
            </h1>
            <a href="javascript:void(0)" class="np-btn np-btn-submit" id="top_post_btn" hidefocus="true">发表评论</a>
            <div id="commentArea" class="out">

                <div class="np-reply-box blueLight np-reply-box-active" id="np-reply-box" style="">

                    <div class="np-reply-box-content textarea">
                        <textarea tabindex="1" autocomplete="off" name="content" accesskey="u" id="top_textarea" style="height: 82px; padding: 10px;"></textarea>
                    </div>
                    <div id="insertPicList" class="box_inner" style="display: none;">
                        <ul class="insert_piclist cf" style="display: block;">
                            <li class="list_item upAddPic"><a href="javascript:void(0)" class="add_pic" hidefocus="true"><i class="add">+</i></a>
                                <form action="https://cdc.tencent.com/wp-content/plugins/coral-comment/api.php?method=upload" method="post" enctype="multipart/form-data" target="iframe0" id="form10">
                                    <!-- input type="file"  class="add_file" name="picture" accept="image/*"-->
                                    <input name="thrdes" type="hidden" value="insertPicList">
                                    <input name="type" type="hidden" value="1">
                                    <input name="format" type="hidden" value="SCRIPT">
                                    <input name="callback" type="hidden" value="parent.upLoadImg">
                                    <input name="_method" type="hidden" value="put">
                                    <!-- <input name="plat" type="hidden" value="1"> -->
                                    <input name="g_tk" type="hidden" value="">
                                    <input name="code" type="hidden" value="0">
                                    <input name="source" type="hidden" value="1">
                                </form>
                            </li>
                        </ul>
                    </div>

                    <div class="commtSub np-reply-box-footer" id="p_login_btn">
                        <!-- 用户登录模块 -->
                        <div class="np-login" id="loginFlag">
                            <img width="35" height="35" class="np-avatar" src="https://cdc.tencent.com/2020/05/22/frontend-state-management-research/">
                            <span class="">
                                <em class="np-user"></em>
                                <a class="" href="https://film.qq.com/vip.html" target="_blank" hidefocus="true"></a>
                            </span>
                            <a href="javascript:void(0)" class="np-btn logout" hidefocus="true">登出</a>
                        </div>

                        <div class="submitBtn">
                            <span class="np-tip-error" style="display:none"></span>
                        </div>
                    </div>

                </div>

            </div>

        </div>


        <!--评论显示列表-->

        <div id="content">
            <!-- <ul class="np-nav-tab">
                <li id="myAllComment" class="np-active">全部评论</li>
                <li id="myCowComment">我的评论
                    <span id="popMsg" class="np-tip-num"></span>
                </li>
                <!- -->
            

            <div id="tab1_allComments">
                <!--页卡一 全部评论-->

                <!-- <div id="order" class="np-order np-btngroup"><a data-sort="time" href="javascript:void(0)" class="np-active">时间</a><a data-sort="quality" href="javascript:void(0)">热度</a>
                </div> -->
                <!--推荐评论-->


                <div id="showNum" class="showNum">

                    <span></span>

                </div>

                <div id="allComments">

                    <ul class="post-list np-comment-list"></ul>
                    <div class="tipInfo">暂无评论</div>
                    <!--loadding图标-->

                </div>
                <!-- 全部评论 -->


                <div id="loadMore" class="np-load-more">

                    <span>查看更多评论</span>
                    <em style="display:none">没有更多了</em>

                </div>

            </div>

            <div id="tab2_myComments" class=" my-comments" style="display:none">
                <!--页卡二 我的牛评-->
                <div class="np-btngroup np-btngroup-notice"><a href="javascript:void(0)" id="mytips" class="np-active" hidefocus="true">提醒</a><a id="mycon" href="javascript:void(0)" hidefocus="true">评论</a>
                </div>

                <div id="tab3_tips" class="dis">

                    <div id="my-message" class="my-message">

                        <div class="tipInfo waitting">

                        </div>


                        <ul id="my-message-list" class="post-list np-notice-list">

                        </ul>

                        <div class="np-load-more" id="loadMsgMore" style="display:none">
                            <span>查看更多评论</span>
                            <em style="display:none">没有更多了</em>
                        </div>
                    </div>



                </div>

                <div id="tab4_mycon" style="display:none" class="undis">


                    <div id="my-notification" class="my-notification ">

                        <div class="tipInfo waitting">

                        </div>
                        <div class="np-person-info np-person-info-weak" id="myuserInfo" style="display:none">
                            <img class="np-avatar" src="https://cdc.tencent.com/2020/05/22/frontend-state-management-research/">
                            <span class="">
                                <em class="np-user">企鹅先生</em>
                                <a class="" href="https://cdc.tencent.com/2020/05/22/frontend-state-management-research/" target="_blank" hidefocus="true"></a>
                            </span>
                            <div>
                                <span class="np-btn-area">
                                    <em class="a">中国 北京 海淀</em>
                                </span>
                                <span class="np-btn-upvote">
                                    <em class="b">0</em>
                                </span>
                                <span class="np-btn-reply">
                                    <em class="c">1</em>
                                </span>
                            </div>
                        </div>
                        <ul id="my-notification-list" class="post-list np-timeline">

                        </ul>


                        <div class="np-load-more" id="loadCmtMore">

                            <span>加载更多</span>
                            <em style="display:none">没有更多了</em>

                        </div>


                    </div>

                </div>

            </div>

        </div>

        <div id="hiddenCon" class="hiddenCon" style="display:none">


        </div>

        <!--弹出举报框-->
        <div class="np-report" id="public_report" style="display:none">
            <div class="report-con">
                <div class="np-report-header">
                    <h4>举报</h4>
                    <a href="javascript:void(0)" class="close" hidefocus="true"></a>
                </div>
                <div class="np-report-content">
                    <h5>
                        举报此评论的原因</h5>
                    <ul>
                        <li>
                            <input name="impeach_content" id="content1" type="radio" value="1">
                            <label for="content1">色情淫秽</label>
                        </li>

                        <li>
                            <input name="impeach_content" id="content4" type="radio" value="8">
                            <label for="content4">骚扰谩骂</label>
                        </li>

                        <li>
                            <input name="impeach_content" id="content1024" type="radio" value="1024">
                            <label for="content1024">广告欺诈</label>
                        </li>

                        <li>
                            <input name="impeach_content" id="content16384" type="radio" value="2048">
                            <label for="content16384">反动</label>
                        </li>
                        <li>
                            <input name="impeach_content" id="content0" type="radio" value="0">
                            <label for="content0">其他</label>
                        </li>
                    </ul>
                    <div>
                        <h6>举报说明（可选）：</h6>
                        <textarea name="impeach_desc" placeholder="请描述该评论的恶意行为" style=" color:#bbb;" id="impeach_desc" type="text" maxlength="200/"></textarea>
                    </div>
                </div>
                <div class="np-report-footer">
                    <a class="np-btn np-report-submit" href="javascript:void(0)" hidefocus="true">提交</a>
                    <a class="np-btn np-report-cancel" href="javascript:void(0)" hidefocus="true">取消</a>
                </div>
            </div>
        </div>

        <!--弹出评论框-->
        <div class="pop_reply np-reply-box np-reply-box-inline" id="public_reply" style="display:none">
            <div class="textarea np-reply-box-content">
                <textarea tabindex="1" autocomplete="off" name="content" accesskey="u" id="top_textarea"></textarea>
            </div>
            <div id="insertPicList_reply" class="box_inner" style="display: none;">
                <ul class="insert_piclist cf" style="display: block;">
                    <li class="list_item upAddPic"><a href="javascript:void(0)" class="add_pic" hidefocus="true"><i class="add">+</i></a>
                        <form action="https://upload.coral.qq.com/image/upload" method="post" enctype="multipart/form-data" target="iframe0" id="form10">
                            <!--input type="file" class="add_file" name="picture" accept="image/*" -->
                            
                            <input name="thrdes" type="hidden" value="insertPicList">
                            <input name="type" type="hidden" value="1">
                            <input name="format" type="hidden" value="SCRIPT">
                            <input name="callback" type="hidden" value="parent.upLoadImg">
                            <input name="_method" type="hidden" value="put">
                            <!-- <input name="plat" type="hidden" value="1"> -->
                            <input name="g_tk" type="hidden" value="">
                            <input name="code" type="hidden" value="0">
                            <input name="source" type="hidden" value="1">
                        </form>
                    </li>
                </ul>
            </div>
           
            <a href="javascript:void(0)" class="submit np-btn np-btn-submit" id="pop_post_btn" hidefocus="true">发表评论</a>
            <a href="javascript:void(0)" class="np-cancle" hidefocus="true">取消</a>
        </div>
    </div>

    <!--遮罩层-->
    <div class="maskObj" id="maskObj">
    </div>
	<script type="text/javascript" src="./前端状态管理设计——优雅与妥协的艺术 – 腾讯CDC_files/jquery-1.11.1.min.js"></script> <!---jQuery 库文件-->
    <script src="./前端状态管理设计——优雅与妥协的艺术 – 腾讯CDC_files/qc_jssdk.js" data-appid="101574781" data-redirecturi="https://cdc.tencent.com/wp-content/plugins/coral-comment/qq_callback.php"></script>

<script>
	coralStaticPath = "https://cdc.tencent.com/wp-content/plugins/coral-comment/static";
	cmt_id = 5280666128;

	seajs.use('coral.init',function(CORAL){
		CORAL.init({
            user_login: "https://cdc.tencent.com/wp-content/plugins/coral-comment/api.php?method=user_login",
			article_commentnum: "https://cdc.tencent.com/wp-content/plugins/coral-comment/api.php?method=article_commentnum", // 获取文章的评论数 OK
			article_comment: "https://cdc.tencent.com/wp-content/plugins/coral-comment/api.php?method=article_comment", // 文章的评论列表接口 OK
			article_hotcomment: "https://cdc.tencent.com/wp-content/plugins/coral-comment/api.php?method=article_hotcomment", // 热评接口 OK
			comment_post: "https://cdc.tencent.com/wp-content/plugins/coral-comment/api.php?method=comment_post", //提交评论 OK
			user_msg: "https://cdc.tencent.com/wp-content/plugins/coral-comment/api.php?method=user_msg", // 用户消息接口 OK
			user_comment: "https://cdc.tencent.com/wp-content/plugins/coral-comment/api.php?method=user_comment", // 用户评论接口 OK
			get_userinfo: "https://cdc.tencent.com/wp-content/plugins/coral-comment/api.php?method=get_userinfo", // 获取当前用户信息 OK
			delete_comment: "https://cdc.tencent.com/wp-content/plugins/coral-comment/api.php?method=delete_comment", //用户删除自己的评论的接口 OK
			dig_comment: "https://cdc.tencent.com/wp-content/plugins/coral-comment/api.php?method=dig_comment", // 点赞接口 OK
			cai_comment: "https://cdc.tencent.com/wp-content/plugins/coral-comment/api.php?method=cai_comment", // 踩接口 OK
			report: "https://cdc.tencent.com/wp-content/plugins/coral-comment/api.php?method=report", // 举报接口 OK
            upload: "https://cdc.tencent.com/wp-content/plugins/coral-comment/api.php?method=upload", // 上传文件接口
            comment_enable: true,
            homePageSize: 50		});
	});
</script>	
<script language="javascript" src="./前端状态管理设计——优雅与妥协的艺术 – 腾讯CDC_files/template1.js"></script>  <!--coral-基本方法-->
<script language="javascript" src="./前端状态管理设计——优雅与妥协的艺术 – 腾讯CDC_files/coral.config.js"></script>  <!--coral-基本配置-->
<script language="javascript" src="./前端状态管理设计——优雅与妥协的艺术 – 腾讯CDC_files/coral.base.js"></script>  <!--coral-基本方法 -->
<script language="javascript" src="./前端状态管理设计——优雅与妥协的艺术 – 腾讯CDC_files/coral.center.js"></script>  <!--个人中心代码-->
<script language="javascript" src="./前端状态管理设计——优雅与妥协的艺术 – 腾讯CDC_files/coral.login.js"></script>  <!--登录模块-->
<script language="javascript" src="./前端状态管理设计——优雅与妥协的艺术 – 腾讯CDC_files/coral.img.js"></script>  <!--发布图片模块-->
<script language="javascript" src="./前端状态管理设计——优雅与妥协的艺术 – 腾讯CDC_files/coral.boss.js"></script>  <!--统计代码-->
<script type="text/javascript" src="./前端状态管理设计——优雅与妥协的艺术 – 腾讯CDC_files/coral_v3.6.29.js"></script> <!--入口js文件-->
<script type="text/javascript" src="./前端状态管理设计——优雅与妥协的艺术 – 腾讯CDC_files/coral.callback.js"></script>
<script type="text/javascript" src="./前端状态管理设计——优雅与妥协的艺术 – 腾讯CDC_files/coral.init.js"></script>
<script>
    $("#mainBody").on("click", ".np-cancle", function(){$("#public_reply").hide()});
</script>

	</div>

	<!-- 详情页侧边栏 -->
	
	<!-- 详情页侧边栏 -->

	<div class="sidebar">
		<div class="target">
			<h3>标签</h3>
			<p>
								<a href="https://cdc.tencent.com/?cat=522#search-result" hidefocus="true">技术研发</a>
								
				
							</p>
		</div>
		<div class="relative-read">
			<h3>相关阅读</h3>
			<ul>
							</ul>
		</div>

				<div class="adword">
			<em>在你身边，为你设计II</em>
			<i><a href="http://item.jd.com/11840401.html" hidefocus="true"><img src="./前端状态管理设计——优雅与妥协的艺术 – 腾讯CDC_files/ad_pic-1.jpg" alt="在你身边，为你设计II"></a></i>
		</div>
			</div>
	</div>
<div class="roll-backtop2" id="roll-backtop" style="margin-right: -288px;">返回顶部</div>
<script src="./前端状态管理设计——优雅与妥协的艺术 – 腾讯CDC_files/jquery.qrcode.min.js"></script>
<script>
	$(function(){
		var attrUrl =  "https://cdc.tencent.com/?p=11300";
		$('#qrcode').qrcode({width: 170,height: 170,text: attrUrl});
	})
</script>
<script src="./前端状态管理设计——优雅与妥协的艺术 – 腾讯CDC_files/share.js"></script>
<script>
	var shareHTML = '<span class="weixin-qrcode"><a href="javascript:;" class="share-item share-weixin" data-type="weixin" title="扫一扫分享到微信">微信</a><div class="qrcode" id="qrcode"></div></span><span><a href="javascript:;" class="share-item share-qzone" data-type="qzone" title="分享到QQ空间">QQ空间</a></span><span><a href="javascript:;" class="share-item share-weibo" data-type="weibo" title="分享到新浪微博">新浪微博</a></span><span><a href="javascript:;" class="share-item share-qqweibo" data-type="qqweibo" title="分享到腾讯微博">腾讯微博</a></span>';
	var articleTit = $('.content-title').find('h3').html();
	ui.shareFactory.create($('.share-box'),{
		type:['weixin','qzone','weibo','qqweibo'],
		text:articleTit
	})
</script>
	<div class="g-footer">
		<div class="g-container">
			<div class="links">
				<div class="links-menu">
					<div class="logo">
						<a href="https://cdc.tencent.com/" hidefocus="true"><img src="./前端状态管理设计——优雅与妥协的艺术 – 腾讯CDC_files/logo_footer@2x.png" alt="腾讯CDC"></a>
					</div>
					<p class="copyright">Copyright © 1998 - 2020 Tencent. <span>All Rights Reserved. Powered By Wordpress.</span></p>
				</div>
				<div class="links-menu links-menu2">
					<div class="menu-items"><h4>腾讯设计团队</h4><div class="menu-tx-design-container"><ul id="menu-tx-design" class="menu"><li id="menu-item-8939" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-8939"><a target="_blank" rel="noopener noreferrer" href="http://isux.tencent.com/" hidefocus="true">ISUX</a></li>
<li id="menu-item-8941" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-8941"><a target="_blank" rel="noopener noreferrer" href="http://tgideas.qq.com/" hidefocus="true">TGideas</a></li>
<li id="menu-item-8942" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-8942"><a target="_blank" rel="noopener noreferrer" href="http://www.alloyteam.com/" hidefocus="true">AlloyTeam</a></li>
<li id="menu-item-9242" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-9242"><a target="_blank" rel="noopener noreferrer" href="http://qqfe.org/" hidefocus="true">FERD</a></li>
</ul></div></div><div class="menu-items"><h4>友情链接</h4><div class="menu-friend-links-container"><ul id="menu-friend-links" class="menu"><li id="menu-item-8933" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-8933"><a target="_blank" rel="noopener noreferrer" href="http://jdc.jd.com/" hidefocus="true">JDC</a></li>
<li id="menu-item-8938" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-8938"><a target="_blank" rel="noopener noreferrer" href="https://ixdc.org/2020/?lang=zh" hidefocus="true">IXDC2020</a></li>
<li id="menu-item-8934" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-8934"><a target="_blank" rel="noopener noreferrer" href="http://www.ui.cn/" hidefocus="true">UI中国</a></li>
<li id="menu-item-9878" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-9878"><a target="_blank" rel="noopener noreferrer" href="http://www.uisdc.com/" hidefocus="true">优设网</a></li>
<li id="menu-item-10701" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-10701"><a href="http://sicc.tencent.com/" hidefocus="true">SICC</a></li>
<li id="menu-item-10704" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-10704"><a href="http://dcloud.qq.com/" hidefocus="true">设计云</a></li>
</ul></div></div>				</div>
			</div>
		</div>
	</div>
	<!-- <div class="mask-backdrop"></div> -->
	<div class="roll-backtop" id="roll-backtop">返回顶部</div>
	<script type="text/javascript" src="./前端状态管理设计——优雅与妥协的艺术 – 腾讯CDC_files/stats" charset="UTF-8"></script>
	<script type="text/javascript" src="./前端状态管理设计——优雅与妥协的艺术 – 腾讯CDC_files/wp-embed.min.js"></script>
	<script src="./前端状态管理设计——优雅与妥协的艺术 – 腾讯CDC_files/swiper.min.7f20.js"></script>
	<script src="./前端状态管理设计——优雅与妥协的艺术 – 腾讯CDC_files/main.js"></script>
	<script type="text/javascript">if(window._satellite) _satellite.pageBottom();</script>



<iframe src="./前端状态管理设计——优雅与妥协的艺术 – 腾讯CDC_files/PMProxy.html" style="width: 0px; height: 0px; display: none; overflow: hidden;"></iframe><iframe id="iframe0" name="iframe0" style="display:none" src="./前端状态管理设计——优雅与妥协的艺术 – 腾讯CDC_files/saved_resource.html"><script type="text/javascript"></script></iframe><iframe sandbox="allow-scripts allow-same-origin" title="Adobe ID Syncing iFrame" id="destination_publishing_iframe_tengxun_0" src="./前端状态管理设计——优雅与妥协的艺术 – 腾讯CDC_files/dest5.html" class="aamIframeLoaded" style="display: none; width: 0px; height: 0px;"></iframe></body></html>